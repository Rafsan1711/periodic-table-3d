<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Periodic Table</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        @import url('https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --text-primary: #f0f6fc;
            --text-secondary: #8b949e;
            --border-primary: #30363d;
            --accent-blue: #58a6ff;
            --accent-purple: #bc8cff;
            --accent-green: #7ce38b;
            --accent-orange: #ffa657;
            --accent-red: #ff7b72;
            --accent-yellow: #f2cc60;
            --shadow-lg: 0 16px 32px rgba(0, 0, 0, 0.24);
            --shadow-md: 0 8px 16px rgba(0, 0, 0, 0.16);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: auto;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 32px;
            padding: 40px 0;
        }
        
        .header h1 {
            font-size: clamp(2.5rem, 5vw, 3.5rem);
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }
        
        .header p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            font-weight: 300;
        }
        
        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin-bottom: 32px;
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .legend-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--border-primary);
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .periodic-table {
            display: grid;
            grid-template-columns: repeat(19, 1fr);
            gap: 3px;
            margin-bottom: 40px;
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-primary);
            overflow-x: auto;
            min-width: 1140px;
        }
        
        .element {
            aspect-ratio: 1;
            min-width: 50px;
            max-width: 60px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            font-size: 0.75rem;
        }
        
        .element::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .element:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-blue);
            z-index: 10;
        }
        
        .element:hover::before {
            opacity: 1;
        }
        
        .element.active {
            transform: translateY(-6px) scale(1.08);
            box-shadow: 0 0 32px rgba(88, 166, 255, 0.4);
            border-color: var(--accent-blue);
            z-index: 20;
        }
        
        .element-header {
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.6rem;
            color: var(--text-secondary);
            font-weight: 400;
        }
        
        .element .symbol {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 8px 0 2px 0;
            z-index: 1;
        }
        
        .element .number {
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-weight: 500;
            z-index: 1;
        }
        
        /* Element category colors */
        .nonmetal { 
            background: linear-gradient(135deg, #1a365d, #2a4a6b);
            border-color: #3182ce;
        }
        .nonmetal .symbol { color: #63b3ed; }
        
        .noblegas { 
            background: linear-gradient(135deg, #553c9a, #6b46c1);
            border-color: #8b5cf6;
        }
        .noblegas .symbol { color: #c4b5fd; }
        
        .alkalimetal { 
            background: linear-gradient(135deg, #c05621, #dd6b20);
            border-color: #ed8936;
        }
        .alkalimetal .symbol { color: #fbd38d; }
        
        .alkearthmetal { 
            background: linear-gradient(135deg, #2c7a7b, #319795);
            border-color: #38b2ac;
        }
        .alkearthmetal .symbol { color: #81e6d9; }
        
        .metalloid { 
            background: linear-gradient(135deg, #805ad5, #9f7aea);
            border-color: #b794f6;
        }
        .metalloid .symbol { color: #d6bcfa; }
        
        .halogen { 
            background: linear-gradient(135deg, #d69e2e, #ecc94b);
            border-color: #f6e05e;
        }
        .halogen .symbol { color: #faf089; }
        
        .transitionmetal { 
            background: linear-gradient(135deg, #4a5568, #718096);
            border-color: #a0aec0;
        }
        .transitionmetal .symbol { color: #e2e8f0; }
        
        .post-transitionmetal { 
            background: linear-gradient(135deg, #e53e3e, #f56565);
            border-color: #fc8181;
        }
        .post-transitionmetal .symbol { color: #fed7d7; }
        
        .lanthanide { 
            background: linear-gradient(135deg, #d53f8c, #e53e3e);
            border-color: #f687b3;
        }
        .lanthanide .symbol { color: #fbb6ce; }
        
        .actinide { 
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border-color: #718096;
        }
        .actinide .symbol { color: #cbd5e0; }
        
        .unknown { 
            background: linear-gradient(135deg, #1a202c, #2d3748);
            border-color: #4a5568;
        }
        .unknown .symbol { color: #a0aec0; }
        
        .lanthanide-series, .actinide-series {
            margin-top: 24px;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
            overflow-x: auto;
        }
        
        .series-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            text-align: center;
        }
        
        .series-elements {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 3px;
            min-width: 900px;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-primary);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 8px;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
        }
        
        .close-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: scale(1.1);
        }
        
        .modal-body {
            padding: 32px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            align-items: start;
        }
        
        .atom-viewer {
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
            height: 400px;
            position: relative;
        }
        
        .atom-info {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .info-section {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
        }
        
        .info-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent-blue);
            margin-bottom: 16px;
            border-bottom: 1px solid var(--border-primary);
            padding-bottom: 8px;
        }
        
        .property {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .property:last-child {
            border-bottom: none;
        }
        
        .property-label {
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .property-value {
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .wiki-section {
            grid-column: 1 / -1;
            margin-top: 24px;
        }
        
        .wiki-content {
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-primary);
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1200px) {
            .periodic-table {
                padding: 16px;
                margin: 0 -20px;
                border-radius: 0;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .header {
                padding: 20px 0;
                margin-bottom: 24px;
            }
            
            .legend {
                padding: 16px;
                gap: 8px;
            }
            
            .legend-item {
                font-size: 0.75rem;
                padding: 6px 10px;
            }
            
            .periodic-table {
                gap: 2px;
                min-width: 950px;
            }
            
            .element {
                min-width: 45px;
                max-width: 50px;
                font-size: 0.7rem;
            }
            
            .element .symbol {
                font-size: 1rem;
            }
            
            .modal-content {
                width: 95%;
                max-height: 85vh;
            }
            
            .modal-header {
                padding: 20px 24px;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
            
            .modal-body {
                padding: 24px;
                grid-template-columns: 1fr;
                gap: 24px;
            }
            
            .atom-viewer {
                height: 300px;
            }
            
            .series-elements {
                min-width: 750px;
            }
        }
        
        @media (max-width: 480px) {
            .periodic-table {
                min-width: 800px;
            }
            
            .element {
                min-width: 38px;
                max-width: 42px;
            }
            
            .element .symbol {
                font-size: 0.9rem;
            }
            
            .series-elements {
                min-width: 600px;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border-primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
        
        /* Loading animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-primary);
            border-radius: 50%;
            border-top-color: var(--accent-blue);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Pulse animation for active elements */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(88, 166, 255, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(88, 166, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(88, 166, 255, 0); }
        }
        
        .element.active {
            animation: pulse 2s infinite;
        }

/* Toggle switch */
.page-toggle {
  display:flex;
  align-items:center;
  gap:16px;
  justify-content:center;
  margin: 20px 0;
}
.switch {
  position: relative;
  display: inline-block;
  width: 58px;
  height: 32px;
}
.switch input { display:none; }
.slider {
  position:absolute;
  cursor:pointer;
  inset:0;
  background:var(--bg-tertiary);
  border-radius:999px;
  border:1px solid var(--border-primary);
  transition: all .25s ease;
  box-shadow: var(--shadow-md);
}
.slider::after {
  content:'';
  position:absolute;
  left:4px;
  top:4px;
  width:24px;
  height:24px;
  background:var(--bg-primary);
  border-radius:50%;
  transition: transform .25s ease;
  box-shadow: 0 6px 14px rgba(0,0,0,0.35);
}
.switch input:checked + .slider {
  background: linear-gradient(90deg,var(--accent-blue),var(--accent-purple));
  border-color: transparent;
}
.switch input:checked + .slider::after {
  transform: translateX(26px);
}

/* labels */
.toggle-labels { display:flex; gap:12px; align-items:center; color:var(--text-secondary); font-weight:500; }
#labelPeriodic { opacity:1; transition:.2s; }
#labelMolecules { opacity:0.5; transition:.2s; }

/* Molecules page layout */
.molecules-page { padding: 12px 20px; }
.molecules-container {
  background: var(--bg-secondary);
  border:1px solid var(--border-primary);
  border-radius: var(--radius-md);
  padding:18px;
  box-shadow: var(--shadow-md);
}
.molecules-controls {
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:12px;
}
#moleculeSearch {
  flex:1;
  padding:10px 14px;
  background: var(--bg-tertiary);
  border:1px solid var(--border-primary);
  border-radius:10px;
  color:var(--text-primary);
  font-size:1rem;
}
.sort-controls button {
  padding:8px 12px;
  border-radius:8px;
  border:1px solid var(--border-primary);
  background:transparent;
  color:var(--text-secondary);
  cursor:pointer;
}
.sort-controls button.active {
  background: linear-gradient(135deg,var(--accent-blue),var(--accent-purple));
  color: white;
  border-color: transparent;
}

/* list */
.molecules-list {
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
  gap:10px;
  margin-top:8px;
}
.molecule-item {
  padding:12px;
  background:var(--bg-tertiary);
  border-radius:10px;
  border:1px solid var(--border-primary);
  display:flex;
  align-items:center;
  gap:12px;
  cursor:pointer;
  transition: transform .15s ease, box-shadow .15s ease;
}
.molecule-item:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}
.molecule-badge {
  width:52px; height:52px; border-radius:8px;
  display:flex;align-items:center;justify-content:center;
  background: linear-gradient(135deg,var(--accent-green),var(--accent-blue));
  color:#041124; font-weight:700;
}
.molecule-meta { flex:1; }
.molecule-name { font-weight:700; color:var(--text-primary); }
.molecule-formula { color:var(--text-secondary); font-size:0.9rem; }

/* matter modal tweaks (ensure on top) */
#matterModal { z-index:1200; }
#matterModal .modal-content { max-width:980px; }

/* 2D drawing container */
#matter2D svg { width:100%; height:100%; display:block; }

/* small responsive */
@media (max-width:768px){
  .molecules-list { grid-template-columns: repeat(auto-fill,minmax(160px,1fr)); }
}

/* Updated Toggle */
.toggle-container {
  display: flex;
  background: var(--bg-tertiary);
  border-radius: 12px;
  border: 1px solid var(--border-primary);
  padding: 4px;
  gap: 4px;
}

.toggle-btn {
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--text-secondary);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 500;
}

.toggle-btn.active {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  color: white;
}

/* Reactions Page */
.reactions-page {
  padding: 20px;
}

.reaction-viewer-container {
  max-width: 1400px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.reaction-screen {
  background: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-lg);
  height: 450px;
  position: relative;
  overflow: hidden;
}

.reaction-canvas {
  width: 100%;
  height: 100%;
}

.equation-builder {
  background: var(--bg-secondary);
  border: 1px solid var(--border-primary);
  border-radius: var(--radius-md);
  padding: 24px;
}

.equation-section {
  display: flex;
  align-items: center;
  gap: 16px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.section-label {
  font-weight: 600;
  color: var(--accent-blue);
  min-width: 90px;
}

.equation-items {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
  min-height: 40px;
}

.add-item-btn {
  width: 40px;
  height: 40px;
  border: 2px dashed var(--border-primary);
  background: transparent;
  color: var(--text-secondary);
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.2s ease;
}

.add-item-btn:hover {
  border-color: var(--accent-blue);
  color: var(--accent-blue);
}

.equation-item {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-primary);
  font-weight: 500;
}

.equation-item .remove-btn {
  background: none;
  border: none;
  color: var(--accent-red);
  cursor: pointer;
  font-size: 16px;
}

.arrow-section {
  font-size: 28px;
  font-weight: bold;
  color: var(--accent-blue);
  margin: 0 12px;
}

.auto-text {
  color: var(--text-secondary);
  font-style: italic;
}

.equation-controls {
  display: flex;
  gap: 12px;
  justify-content: center;
}

.control-btn {
  padding: 10px 20px;
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  background: var(--bg-tertiary);
  color: var(--text-primary);
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s ease;
}

.control-btn:hover {
  transform: translateY(-2px);
}

.control-btn.primary {
  background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
  color: white;
  border: none;
}

.item-card {
  background: var(--bg-tertiary);
  border: 1px solid var(--border-primary);
  border-radius: 8px;
  padding: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-align: center;
}

.item-card:hover {
  transform: translateY(-4px);
  box-shadow: var(--shadow-lg);
}

.item-card .formula {
  font-weight: 700;
  color: var(--accent-blue);
  margin-bottom: 4px;
}

.item-card .name {
  color: var(--text-secondary);
  font-size: 0.85rem;
}
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
          <!-- Page toggle (উপরে header-এর নিচে বসাও) -->
<div class="page-toggle">
  <div class="toggle-container">
    <button class="toggle-btn active" data-page="periodic">Periodic Table</button>
    <button class="toggle-btn" data-page="molecules">Molecules</button>
    <button class="toggle-btn" data-page="reactions">Reactions</button>
  </div>
</div>
            <h1>Interactive Periodic Table</h1>
            <p>Explore the building blocks of matter with 3D atomic visualization</p>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color nonmetal"></div>
                <span>Non metals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color noblegas"></div>
                <span>Noble Gases</span>
            </div>
            <div class="legend-item">
                <div class="legend-color alkalimetal"></div>
                <span>Alkali Metals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color alkearthmetal"></div>
                <span>Alkaline Earth Metals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color transitionmetal"></div>
                <span>Transition Metals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color metalloid"></div>
                <span>Metalloids</span>
            </div>
            <div class="legend-item">
                <div class="legend-color halogen"></div>
                <span>Halogens</span>
            </div>
            <div class="legend-item">
                <div class="legend-color post-transitionmetal"></div>
                <span>Post transition Metals</span>
            </div>
            <div class="legend-item">
                <div class="legend-color lanthanide"></div>
                <span>Lanthanoids</span>
            </div>
            <div class="legend-item">
                <div class="legend-color actinide"></div>
                <span>Actinoids</span>
            </div>
            <div class="legend-item">
                <div class="legend-color unknown"></div>
                <span>Unknown</span>
            </div>
        </div>
        
        <div class="periodic-table" id="periodicTable"></div>
        
        <div class="lanthanide-series">
            <div class="series-title">Lanthanide Series</div>
            <div class="series-elements" id="lanthanideElements"></div>
        </div>
        
        <div class="actinide-series">
            <div class="series-title">Actinide Series</div>
            <div class="series-elements" id="actinideElements"></div>
        </div>
    </div>
    
    <div class="modal" id="elementModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Element Details</div>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="atom-viewer" id="atomViewer"></div>
                <div class="atom-info" id="atomInfo"></div>
                <div class="wiki-section">
                    <div class="info-section">
                        <h3>Wikipedia Summary</h3>
                        <div class="wiki-content" id="wikiContent">
                            <div class="loading"></div>
                            <span>Loading information...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- Molecules page (ডিফল্টে hidden; toggle করলে দেখাবে) -->
<div id="moleculesPage" class="molecules-page" aria-hidden="true" style="display:none;">
  <div class="molecules-container">
    <div class="molecules-controls">
      <input id="moleculeSearch" type="search" placeholder="Search molecules (e.g. CO₂, water, benzene)..." />
      <div class="sort-controls">
        <button id="sortAZ" class="active">A → Z</button>
        <button id="sortScore">Best match</button>
      </div>
    </div>

    <div class="molecules-list-wrapper">
      <div id="moleculesList" class="molecules-list"></div>
    </div>
  </div>
</div>

<!-- Matter Modal (structure same as element modal) -->
<div class="modal" id="matterModal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="matterModalTitle">Matter Details</div>
      <button class="close-btn" id="closeMatterModal">&times;</button>
    </div>

    <div class="modal-body">
      <div class="atom-viewer" id="matterViewer"></div>

      <div class="atom-info" id="matterInfo">
        <!-- same info sections as atom modal -->
      </div>

      <div class="wiki-section" style="grid-column:1/-1;margin-top:18px;">
        <div class="info-section">
          <h3>Wikipedia Summary</h3>
          <div class="wiki-content" id="matterWiki">
            <div class="loading"></div><span>Loading information...</span>
          </div>
        </div>
      </div>

      <!-- 2D representation below wiki (small) -->
      <div style="grid-column:1/-1;margin-top:12px;">
        <div class="info-section">
          <h3>2D Structure</h3>
          <div id="matter2D" style="height:200px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>

    <!-- Reactions Page -->
<div id="reactionsPage" class="reactions-page" style="display:none;" aria-hidden="true">
  <div class="reaction-viewer-container">
    <!-- Theatre Screen -->
    <div class="reaction-screen" id="reactionScreen">
      <div class="reaction-canvas" id="reactionCanvas"></div>
    </div>
    
    <!-- Equation Builder -->
    <div class="equation-builder">
      <div class="equation-section">
        <!-- Reactants Section -->
        <div class="reactants-section">
          <span class="section-label">Reactants:</span>
          <div class="equation-items" id="reactantsContainer">
            <button class="add-item-btn" data-type="reactant">+</button>
          </div>
        </div>
        
        <!-- Arrow -->
        <div class="arrow-section">→</div>
        
        <!-- Products Section (Auto-filled) -->
        <div class="products-section">
          <span class="section-label">Products:</span>
          <div class="equation-items" id="productsContainer">
            <span class="auto-text">Auto-generated</span>
          </div>
        </div>
      </div>
      
      <!-- Control Buttons -->
      <div class="equation-controls">
        <button id="predictProducts" class="control-btn">Predict Products</button>
        <button id="runReaction" class="control-btn primary">Run Reaction</button>
        <button id="clearEquation" class="control-btn">Clear All</button>
      </div>
    </div>
  </div>
</div>

<!-- Selection Modal -->
<div class="modal" id="itemSelectionModal" aria-hidden="true">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Select Reactant</div>
      <button class="close-btn" id="closeItemModal">&times;</button>
    </div>
    <div class="modal-body">
      <input id="itemSearch" type="search" placeholder="Search..." style="width:100%;padding:12px;margin-bottom:16px;background:var(--bg-tertiary);border:1px solid var(--border-primary);border-radius:8px;color:var(--text-primary);" />
      <div class="items-grid" id="itemsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;max-height:400px;overflow-y:auto;"></div>
    </div>
  </div>
</div>
    <script>
        // Elements data from the GitHub repository
        const elementsData = [
            { number: 1, symbol: "H", name: "Hydrogen", weight: 1.008, category: "nonmetal" },
            { number: 2, symbol: "He", name: "Helium", weight: 4.0026, category: "noblegas" },
            { number: 3, symbol: "Li", name: "Lithium", weight: 6.941, category: "alkalimetal" },
            { number: 4, symbol: "Be", name: "Beryllium", weight: 9.0122, category: "alkearthmetal" },
            { number: 5, symbol: "B", name: "Boron", weight: 10.811, category: "metalloid" },
            { number: 6, symbol: "C", name: "Carbon", weight: 12.0107, category: "nonmetal" },
            { number: 7, symbol: "N", name: "Nitrogen", weight: 14.0067, category: "nonmetal" },
            { number: 8, symbol: "O", name: "Oxygen", weight: 15.9994, category: "nonmetal" },
            { number: 9, symbol: "F", name: "Fluorine", weight: 18.9984, category: "halogen" },
            { number: 10, symbol: "Ne", name: "Neon", weight: 20.1797, category: "noblegas" },
            { number: 11, symbol: "Na", name: "Sodium", weight: 22.9897, category: "alkalimetal" },
            { number: 12, symbol: "Mg", name: "Magnesium", weight: 24.3050, category: "alkearthmetal" },
            { number: 13, symbol: "Al", name: "Aluminum", weight: 26.9815, category: "post-transitionmetal" },
            { number: 14, symbol: "Si", name: "Silicon", weight: 28.0855, category: "metalloid" },
            { number: 15, symbol: "P", name: "Phosphorus", weight: 30.9769, category: "nonmetal" },
            { number: 16, symbol: "S", name: "Sulfur", weight: 32.065, category: "nonmetal" },
            { number: 17, symbol: "Cl", name: "Chlorine", weight: 35.453, category: "halogen" },
            { number: 18, symbol: "Ar", name: "Argon", weight: 39.948, category: "noblegas" },
            { number: 19, symbol: "K", name: "Potassium", weight: 39.0983, category: "alkalimetal" },
            { number: 20, symbol: "Ca", name: "Calcium", weight: 40.078, category: "alkearthmetal" },
            { number: 21, symbol: "Sc", name: "Scandium", weight: 44.9559, category: "transitionmetal" },
            { number: 22, symbol: "Ti", name: "Titanium", weight: 47.867, category: "transitionmetal" },
            { number: 23, symbol: "V", name: "Vanadium", weight: 50.9415, category: "transitionmetal" },
            { number: 24, symbol: "Cr", name: "Chromium", weight: 51.9962, category: "transitionmetal" },
            { number: 25, symbol: "Mn", name: "Manganese", weight: 54.9380, category: "transitionmetal" },
            { number: 26, symbol: "Fe", name: "Iron", weight: 55.845, category: "transitionmetal" },
            { number: 27, symbol: "Co", name: "Cobalt", weight: 58.9332, category: "transitionmetal" },
            { number: 28, symbol: "Ni", name: "Nickel", weight: 58.6934, category: "transitionmetal" },
            { number: 29, symbol: "Cu", name: "Copper", weight: 63.546, category: "transitionmetal" },
            { number: 30, symbol: "Zn", name: "Zinc", weight: 65.38, category: "transitionmetal" },
            { number: 31, symbol: "Ga", name: "Gallium", weight: 69.723, category: "post-transitionmetal" },
            { number: 32, symbol: "Ge", name: "Germanium", weight: 72.64, category: "metalloid" },
            { number: 33, symbol: "As", name: "Arsenic", weight: 74.9216, category: "metalloid" },
            { number: 34, symbol: "Se", name: "Selenium", weight: 78.96, category: "nonmetal" },
            { number: 35, symbol: "Br", name: "Bromine", weight: 79.904, category: "halogen" },
            { number: 36, symbol: "Kr", name: "Krypton", weight: 83.798, category: "noblegas" },
            { number: 37, symbol: "Rb", name: "Rubidium", weight: 85.4678, category: "alkalimetal" },
            { number: 38, symbol: "Sr", name: "Strontium", weight: 87.62, category: "alkearthmetal" },
            { number: 39, symbol: "Y", name: "Yttrium", weight: 88.9058, category: "transitionmetal" },
            { number: 40, symbol: "Zr", name: "Zirconium", weight: 91.224, category: "transitionmetal" },
            { number: 41, symbol: "Nb", name: "Niobium", weight: 92.9064, category: "transitionmetal" },
            { number: 42, symbol: "Mo", name: "Molybdenum", weight: 95.96, category: "transitionmetal" },
            { number: 43, symbol: "Tc", name: "Technetium", weight: 98.000, category: "transitionmetal" },
            { number: 44, symbol: "Ru", name: "Ruthenium", weight: 101.07, category: "transitionmetal" },
            { number: 45, symbol: "Rh", name: "Rhodium", weight: 102.9055, category: "transitionmetal" },
            { number: 46, symbol: "Pd", name: "Palladium", weight: 106.42, category: "transitionmetal" },
            { number: 47, symbol: "Ag", name: "Silver", weight: 107.8682, category: "transitionmetal" },
            { number: 48, symbol: "Cd", name: "Cadmium", weight: 112.441, category: "transitionmetal" },
            { number: 49, symbol: "In", name: "Indium", weight: 114.818, category: "post-transitionmetal" },
            { number: 50, symbol: "Sn", name: "Tin", weight: 118.710, category: "post-transitionmetal" },
            { number: 51, symbol: "Sb", name: "Antimony", weight: 121.760, category: "metalloid" },
            { number: 52, symbol: "Te", name: "Tellurium", weight: 127.60, category: "metalloid" },
            { number: 53, symbol: "I", name: "Iodine", weight: 126.9044, category: "halogen" },
            { number: 54, symbol: "Xe", name: "Xenon", weight: 131.293, category: "noblegas" },
            { number: 55, symbol: "Cs", name: "Cesium", weight: 132.9054, category: "alkalimetal" },
            { number: 56, symbol: "Ba", name: "Barium", weight: 137.327, category: "alkearthmetal" },
            { number: 57, symbol: "La", name: "Lanthanum", weight: 138.9054, category: "lanthanide" },
            { number: 58, symbol: "Ce", name: "Cerium", weight: 140.116, category: "lanthanide" },
            { number: 59, symbol: "Pr", name: "Praseodymium", weight: 140.9076, category: "lanthanide" },
            { number: 60, symbol: "Nd", name: "Neodymium", weight: 144.242, category: "lanthanide" },
            { number: 61, symbol: "Pm", name: "Promethium", weight: 145.000, category: "lanthanide" },
            { number: 62, symbol: "Sm", name: "Samarium", weight: 150.36, category: "lanthanide" },
            { number: 63, symbol: "Eu", name: "Europium", weight: 151.964, category: "lanthanide" },
            { number: 64, symbol: "Gd", name: "Gadolinium", weight: 157.25, category: "lanthanide" },
            { number: 65, symbol: "Tb", name: "Terbium", weight: 158.9253, category: "lanthanide" },
            { number: 66, symbol: "Dy", name: "Dysprosium", weight: 162.500, category: "lanthanide" },
            { number: 67, symbol: "Ho", name: "Holmium", weight: 164.9303, category: "lanthanide" },
            { number: 68, symbol: "Er", name: "Erbium", weight: 167.259, category: "lanthanide" },
            { number: 69, symbol: "Tm", name: "Thulium", weight: 168.9342, category: "lanthanide" },
            { number: 70, symbol: "Yb", name: "Ytterbium", weight: 173.054, category: "lanthanide" },
            { number: 71, symbol: "Lu", name: "Lutetium", weight: 174.9668, category: "lanthanide" },
            { number: 72, symbol: "Hf", name: "Hafnium", weight: 178.49, category: "transitionmetal" },
            { number: 73, symbol: "Ta", name: "Tantalum", weight: 180.9478, category: "transitionmetal" },
            { number: 74, symbol: "W", name: "Tungsten", weight: 183.84, category: "transitionmetal" },
            { number: 75, symbol: "Re", name: "Rhenium", weight: 186.207, category: "transitionmetal" },
            { number: 76, symbol: "Os", name: "Osmium", weight: 190.23, category: "transitionmetal" },
            { number: 77, symbol: "Ir", name: "Iridium", weight: 192.217, category: "transitionmetal" },
            { number: 78, symbol: "Pt", name: "Platinum", weight: 195.084, category: "transitionmetal" },
            { number: 79, symbol: "Au", name: "Gold", weight: 196.9665, category: "transitionmetal" },
            { number: 80, symbol: "Hg", name: "Mercury", weight: 200.59, category: "transitionmetal" },
            { number: 81, symbol: "Tl", name: "Thallium", weight: 204.3833, category: "post-transitionmetal" },
            { number: 82, symbol: "Pb", name: "Lead", weight: 207.2, category: "post-transitionmetal" },
            { number: 83, symbol: "Bi", name: "Bismuth", weight: 208.9804, category: "post-transitionmetal" },
            { number: 84, symbol: "Po", name: "Polonium", weight: 210.000, category: "metalloid" },
            { number: 85, symbol: "At", name: "Astatine", weight: 210.000, category: "halogen" },
            { number: 86, symbol: "Rn", name: "Radon", weight: 220.000, category: "noblegas" },
            { number: 87, symbol: "Fr", name: "Francium", weight: 223.000, category: "alkalimetal" },
            { number: 88, symbol: "Ra", name: "Radium", weight: 226.000, category: "alkearthmetal" },
            { number: 89, symbol: "Ac", name: "Actinium", weight: 227, category: "actinide" },
            { number: 90, symbol: "Th", name: "Thorium", weight: 232.0380, category: "actinide" },
            { number: 91, symbol: "Pa", name: "Protactinium", weight: 231.0358, category: "actinide" },
            { number: 92, symbol: "U", name: "Uranium", weight: 238.0289, category: "actinide" },
            { number: 93, symbol: "Np", name: "Neptunium", weight: 237.000, category: "actinide" },
            { number: 94, symbol: "Pu", name: "Plutonium", weight: 244.000, category: "actinide" },
            { number: 95, symbol: "Am", name: "Americium", weight: 243.000, category: "actinide" },
            { number: 96, symbol: "Cm", name: "Curium", weight: 247.000, category: "actinide" },
            { number: 97, symbol: "Bk", name: "Berkelium", weight: 247.000, category: "actinide" },
            { number: 98, symbol: "Cf", name: "Californium", weight: 251.000, category: "actinide" },
            { number: 99, symbol: "Es", name: "Einsteinium", weight: 252.000, category: "actinide" },
            { number: 100, symbol: "Fm", name: "Fermium", weight: 257.000, category: "actinide" },
            { number: 101, symbol: "Md", name: "Mendelevium", weight: 258.000, category: "actinide" },
            { number: 102, symbol: "No", name: "Nobelium", weight: 259.000, category: "actinide" },
            { number: 103, symbol: "Lr", name: "Lawrencium", weight: 262.000, category: "actinide" },
            { number: 104, symbol: "Rf", name: "Rutherfordium", weight: 261.000, category: "transitionmetal" },
            { number: 105, symbol: "Db", name: "Dubnium", weight: 262.000, category: "transitionmetal" },
            { number: 106, symbol: "Sg", name: "Seaborgium", weight: 266.000, category: "transitionmetal" },
            { number: 107, symbol: "Bh", name: "Bohrium", weight: 264.000, category: "transitionmetal" },
            { number: 108, symbol: "Hs", name: "Hassium", weight: 277.000, category: "transitionmetal" },
            { number: 109, symbol: "Mt", name: "Meitnerium", weight: 268.000, category: "unknown" },
            { number: 110, symbol: "Ds", name: "Darmstadtium", weight: 271.000, category: "unknown" },
            { number: 111, symbol: "Rg", name: "Roentgenium", weight: 272.000, category: "unknown" },
            { number: 112, symbol: "Cn", name: "Copernicium", weight: 285.000, category: "unknown" },
            { number: 113, symbol: "Nh", name: "Nihonium", weight: 284.000, category: "unknown" },
            { number: 114, symbol: "Fl", name: "Flerovium", weight: 289.000, category: "unknown" },
            { number: 115, symbol: "Mc", name: "Moscovium", weight: 288.000, category: "unknown" },
            { number: 116, symbol: "Lv", name: "Livermorium", weight: 292.000, category: "unknown" },
            { number: 117, symbol: "Ts", name: "Tennessine", weight: 293.000, category: "unknown" },
            { number: 118, symbol: "Og", name: "Oganesson", weight: 294.000, category: "unknown" }
        ];

        // Position mapping from GitHub repository
        const elementPositions = {
            1: [1, 1], 2: [1, 18],
            3: [2, 1], 4: [2, 2], 5: [2, 13], 6: [2, 14], 7: [2, 15], 8: [2, 16], 9: [2, 17], 10: [2, 18],
            11: [3, 1], 12: [3, 2], 13: [3, 13], 14: [3, 14], 15: [3, 15], 16: [3, 16], 17: [3, 17], 18: [3, 18],
            19: [4, 1], 20: [4, 2], 21: [4, 3], 22: [4, 4], 23: [4, 5], 24: [4, 6], 25: [4, 7], 26: [4, 8],
            27: [4, 9], 28: [4, 10], 29: [4, 11], 30: [4, 12], 31: [4, 13], 32: [4, 14], 33: [4, 15], 34: [4, 16], 35: [4, 17], 36: [4, 18],
            37: [5, 1], 38: [5, 2], 39: [5, 3], 40: [5, 4], 41: [5, 5], 42: [5, 6], 43: [5, 7], 44: [5, 8],
            45: [5, 9], 46: [5, 10], 47: [5, 11], 48: [5, 12], 49: [5, 13], 50: [5, 14], 51: [5, 15], 52: [5, 16], 53: [5, 17], 54: [5, 18],
            55: [6, 1], 56: [6, 2], 57: [6, 3], 72: [6, 4], 73: [6, 5], 74: [6, 6], 75: [6, 7], 76: [6, 8],
            77: [6, 9], 78: [6, 10], 79: [6, 11], 80: [6, 12], 81: [6, 13], 82: [6, 14], 83: [6, 15], 84: [6, 16], 85: [6, 17], 86: [6, 18],
            87: [7, 1], 88: [7, 2], 89: [7, 3], 104: [7, 4], 105: [7, 5], 106: [7, 6], 107: [7, 7], 108: [7, 8],
            109: [7, 9], 110: [7, 10], 111: [7, 11], 112: [7, 12], 113: [7, 13], 114: [7, 14], 115: [7, 15], 116: [7, 16], 117: [7, 17], 118: [7, 18]
        };

        let currentAtom = null;
        let scene, camera, renderer, controls;

        // Initialize the periodic table
        function initPeriodicTable() {
            const table = document.getElementById('periodicTable');
            const lanthanideElements = document.getElementById('lanthanideElements');
            const actinideElements = document.getElementById('actinideElements');

            // Create main periodic table
            for (let row = 1; row <= 7; row++) {
                for (let col = 1; col <= 18; col++) {
                    const element = findElementByPosition(row, col);
                    if (element) {
                        const elementDiv = createElementDiv(element);
                        elementDiv.style.gridRow = row;
                        elementDiv.style.gridColumn = col;
                        table.appendChild(elementDiv);
                    } else {
                        const emptyDiv = document.createElement('div');
                        emptyDiv.style.gridRow = row;
                        emptyDiv.style.gridColumn = col;
                        table.appendChild(emptyDiv);
                    }
                }
            }

            // Create lanthanide series (58-71)
            for (let i = 58; i <= 71; i++) {
                const element = elementsData.find(el => el.number === i);
                if (element) {
                    const elementDiv = createElementDiv(element);
                    lanthanideElements.appendChild(elementDiv);
                }
            }

            // Create actinide series (90-103)
            for (let i = 90; i <= 103; i++) {
                const element = elementsData.find(el => el.number === i);
                if (element) {
                    const elementDiv = createElementDiv(element);
                    actinideElements.appendChild(elementDiv);
                }
            }
        }

        function findElementByPosition(row, col) {
            return elementsData.find(element => {
                const pos = elementPositions[element.number];
                return pos && pos[0] === row && pos[1] === col;
            });
        }

        function createElementDiv(element) {
            const div = document.createElement('div');
            div.className = `element ${element.category}`;
            div.setAttribute('data-number', element.number);
            div.setAttribute('data-symbol', element.symbol);
            div.setAttribute('data-weight', element.weight);
            div.setAttribute('title', element.name);

            div.innerHTML = `
                <div class="element-header">
                    <span class="weight">${element.weight}</span>
                </div>
                <span class="symbol">${element.symbol}</span>
                <span class="number">${element.number}</span>
            `;

            div.addEventListener('click', () => openElementModal(element));
            
            return div;
        }

        function openElementModal(element) {
            document.getElementById('modalTitle').textContent = `${element.name} (${element.symbol})`;
            document.getElementById('elementModal').classList.add('active');
            
            // Remove active class from all elements
            document.querySelectorAll('.element').forEach(el => el.classList.remove('active'));
            
            // Add active class to clicked element
            document.querySelector(`[data-number="${element.number}"]`).classList.add('active');

            // Create 3D atom visualization
            create3DAtom(element);
            
            // Update atom info
            updateAtomInfo(element);
            
            // Load Wikipedia info
            loadWikipediaInfo(element.name);
        }

        function closeModal() {
            document.getElementById('elementModal').classList.remove('active');
            document.querySelectorAll('.element').forEach(el => el.classList.remove('active'));
            
            // Clean up Three.js
            if (renderer) {
                const container = document.getElementById('atomViewer');
                if (container.contains(renderer.domElement)) {
                    container.removeChild(renderer.domElement);
                }
                renderer.dispose();
                renderer = null;
            }
            if (scene) {
                scene.traverse((object) => {
                    if (object.geometry) object.geometry.dispose();
                    if (object.material) {
                        if (Array.isArray(object.material)) {
                            object.material.forEach(material => material.dispose());
                        } else {
                            object.material.dispose();
                        }
                    }
                });
                scene = null;
            }
            camera = null;
            currentAtom = null;
        }

        function create3DAtom(element) {
            const container = document.getElementById('atomViewer');
            container.innerHTML = '';

            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0d1117);

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 0, 20);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);

            // Atom group
            currentAtom = new THREE.Group();
            scene.add(currentAtom);

            // Create nucleus
            const nucleusGeometry = new THREE.SphereGeometry(1, 32, 32);
            const nucleusMaterial = new THREE.MeshPhongMaterial({
                color: 0xff4444,
                emissive: 0x330000,
                shininess: 100
            });
            const nucleus = new THREE.Mesh(nucleusGeometry, nucleusMaterial);
            nucleus.castShadow = true;
            currentAtom.add(nucleus);

            // Create electron shells based on 2n² rule
            const shells = calculateElectronShells(element.number);
            createElectronShells(shells);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 10, 5);
            directionalLight.castShadow = true;
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x4444ff, 0.5);
            pointLight.position.set(-10, -10, 10);
            scene.add(pointLight);

            // Start animation
            animate();
        }

        function calculateElectronShells(atomicNumber) {
            const maxElectronsPerShell = [2, 8, 18, 32, 32, 18, 8]; // 2n² rule
            const shells = [];
            let remainingElectrons = atomicNumber;

            for (let i = 0; i < maxElectronsPerShell.length && remainingElectrons > 0; i++) {
                const electronsInShell = Math.min(remainingElectrons, maxElectronsPerShell[i]);
                shells.push(electronsInShell);
                remainingElectrons -= electronsInShell;
            }

            return shells;
        }

        function createElectronShells(shells) {
            const shellColors = [0x00ff00, 0x0099ff, 0xffff00, 0xff9900, 0xff0099, 0x9900ff, 0xff0000];

            shells.forEach((electronCount, shellIndex) => {
                if (electronCount > 0) {
                    const radius = (shellIndex + 1) * 3;
                    const color = shellColors[shellIndex % shellColors.length];

                    // Create orbital ring
                    const ringGeometry = new THREE.RingGeometry(radius - 0.1, radius + 0.1, 64);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: color,
                        transparent: true,
                        opacity: 0.3,
                        side: THREE.DoubleSide
                    });
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial);
                    currentAtom.add(ring);

                    // Create electrons
                    for (let i = 0; i < electronCount; i++) {
                        const electronGeometry = new THREE.SphereGeometry(0.2, 16, 16);
                        const electronMaterial = new THREE.MeshPhongMaterial({
                            color: color,
                            emissive: color,
                            emissiveIntensity: 0.3
                        });
                        const electron = new THREE.Mesh(electronGeometry, electronMaterial);
                        electron.castShadow = true;

                        const angle = (i / electronCount) * Math.PI * 2;
                        electron.position.set(
                            Math.cos(angle) * radius,
                            Math.sin(angle) * radius,
                            (Math.random() - 0.5) * 0.5
                        );

                        electron.userData = {
                            shellIndex,
                            angle: angle,
                            radius: radius,
                            speed: 0.01 / (shellIndex + 1)
                        };

                        currentAtom.add(electron);
                    }
                }
            });
        }

        function animate() {
            if (!renderer || !scene || !camera) return;

            requestAnimationFrame(animate);

            if (currentAtom) {
                currentAtom.rotation.y += 0.005;

                currentAtom.children.forEach(child => {
                    if (child.userData && child.userData.shellIndex !== undefined) {
                        child.userData.angle += child.userData.speed;
                        child.position.set(
                            Math.cos(child.userData.angle) * child.userData.radius,
                            Math.sin(child.userData.angle) * child.userData.radius,
                            child.position.z
                        );
                    }
                });
            }

            renderer.render(scene, camera);
        }

        function updateAtomInfo(element) {
            const shells = calculateElectronShells(element.number);
            const totalElectrons = shells.reduce((sum, electrons) => sum + electrons, 0);

            document.getElementById('atomInfo').innerHTML = `
                <div class="info-section">
                    <h3>Basic Properties</h3>
                    <div class="property">
                        <span class="property-label">Atomic Number:</span>
                        <span class="property-value">${element.number}</span>
                    </div>
                    <div class="property">
                        <span class="property-label">Atomic Weight:</span>
                        <span class="property-value">${element.weight} u</span>
                    </div>
                    <div class="property">
                        <span class="property-label">Category:</span>
                        <span class="property-value">${formatCategory(element.category)}</span>
                    </div>
                </div>
                <div class="info-section">
                    <h3>Electron Configuration</h3>
                    <div class="property">
                        <span class="property-label">Shell Distribution:</span>
                        <span class="property-value">${shells.join(', ')}</span>
                    </div>
                    <div class="property">
                        <span class="property-label">Total Electrons:</span>
                        <span class="property-value">${totalElectrons}</span>
                    </div>
                </div>
            `;
        }

        function formatCategory(category) {
            const categoryMap = {
                'nonmetal': 'Non Metal',
                'noblegas': 'Noble Gas',
                'alkalimetal': 'Alkali Metal',
                'alkearthmetal': 'Alkaline Earth Metal',
                'transitionmetal': 'Transition Metal',
                'post-transitionmetal': 'Post-Transition Metal',
                'metalloid': 'Metalloid',
                'halogen': 'Halogen',
                'lanthanide': 'Lanthanide',
                'actinide': 'Actinide',
                'unknown': 'Unknown'
            };
            return categoryMap[category] || category;
        }

        function loadWikipediaInfo(elementName) {
            const wikiContent = document.getElementById('wikiContent');
            wikiContent.innerHTML = '<div class="loading"></div><span>Loading information...</span>';

            fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(elementName)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.extract) {
                        wikiContent.innerHTML = `
                            <p>${data.extract}</p>
                            <a href="https://en.wikipedia.org/wiki/${encodeURIComponent(elementName)}" 
                               target="_blank" 
                               style="color: var(--accent-blue); text-decoration: none; font-weight: 500;">
                               Read more on Wikipedia →
                            </a>
                        `;
                    } else {
                        wikiContent.innerHTML = '<p>No Wikipedia information available.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error loading Wikipedia info:', error);
                    wikiContent.innerHTML = '<p>Failed to load Wikipedia information.</p>';
                });
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            initPeriodicTable();
        });

        // Close modal on outside click
        document.getElementById('elementModal').addEventListener('click', (e) => {
            if (e.target.id === 'elementModal') {
                closeModal();
            }
        });

        // ESC key to close modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (renderer && camera) {
                const container = document.getElementById('atomViewer');
                camera.aspect = container.clientWidth / container.clientHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(container.clientWidth, container.clientHeight);
            }
        });
       
       // --- Molecules data (base 5 + 100 new ones; unique, no duplicates) ---
const moleculesData = [
  // --- original few examples (kept as-is) ---
  {
    id: 'co2',
    name: 'Carbon dioxide',
    formula: 'CO₂',
    wikiTitle: 'Carbon_dioxide',
    atoms: [
      { el: 'C', x:0, y:0, z:0 },
      { el: 'O', x:1.16, y:0, z:0 },
      { el: 'O', x:-1.16, y:0, z:0 }
    ],
    bonds: [ [0,1], [0,2] ]
  },
  {
    id: 'h2o',
    name: 'Water',
    formula: 'H₂O',
    wikiTitle: 'Water',
    atoms: [
      { el:'O', x:0, y:0, z:0 },
      { el:'H', x:0.96, y:0.26, z:0 },
      { el:'H', x:-0.96, y:0.26, z:0 }
    ],
    bonds: [ [0,1], [0,2] ]
  },
  {
    id: 'ch4',
    name: 'Methane',
    formula: 'CH₄',
    wikiTitle: 'Methane',
    atoms: [
      { el:'C', x:0,y:0,z:0 },
      { el:'H', x:0.63,y:0.63,z:0.63 },
      { el:'H', x:0.63,y:-0.63,z:-0.63 },
      { el:'H', x:-0.63,y:0.63,z:-0.63 },
      { el:'H', x:-0.63,y:-0.63,z:0.63 }
    ],
    bonds: [ [0,1],[0,2],[0,3],[0,4] ]
  },
  {
    id:'nacl',
    name:'Sodium chloride',
    formula:'NaCl',
    wikiTitle:'Sodium_chloride',
    atoms:[
      {el:'Na',x:-0.7,y:0,z:0},
      {el:'Cl',x:0.7,y:0,z:0}
    ],
    bonds:[[0,1]]
  },
  {
    id:'benzene',
    name:'Benzene',
    formula:'C₆H₆',
    wikiTitle:'Benzene',
    atoms: (function(){
      const R = 1.4; const atoms = [];
      for(let i=0;i<6;i++){
        const a = (i/6)*Math.PI*2;
        atoms.push({el:'C', x: Math.cos(a)*R, y: Math.sin(a)*R, z:0});
      }
      for(let i=0;i<6;i++){
        const a = (i/6)*Math.PI*2;
        atoms.push({el:'H', x: Math.cos(a)*(R+1.05), y: Math.sin(a)*(R+1.05), z:0});
      }
      return atoms;
    })(),
    bonds:(function(){
      const b=[];
      for(let i=0;i<6;i++){ b.push([i,(i+1)%6]); b.push([i,6+i]); }
      return b;
    })()
  },

  // --- 100 additional molecules (simple coordinates + bonds for visualization) ---
  {
    id: 'ethanol',
    name: 'Ethanol',
    formula: 'C₂H₅OH',
    wikiTitle: 'Ethanol',
    atoms: [
      {el:'C', x:-1.0, y:0, z:0}, {el:'C', x:0.0, y:0, z:0}, {el:'O', x:1.1, y:0, z:0},
      {el:'H', x:-1.5,y:0.9,z:0}, {el:'H', x:-1.5,y:-0.9,z:0}, {el:'H', x:0.0,y:0.9,z:0},
      {el:'H', x:0.0,y:-0.9,z:0}, {el:'H', x:1.8,y:0.3,z:0}
    ],
    bonds: [[0,1],[1,2],[0,3],[0,4],[1,5],[1,6],[2,7]]
  },
  {
    id: 'ethane',
    name: 'Ethane',
    formula: 'C₂H₆',
    wikiTitle: 'Ethane',
    atoms: [
      {el:'C', x:-0.6,y:0,z:0},{el:'C', x:0.6,y:0,z:0},
      {el:'H', x:-1.2,y:0.9,z:0},{el:'H', x:-1.2,y:-0.9,z:0},{el:'H', x:-0.6,y:0,z:1.0},
      {el:'H', x:1.2,y:0.9,z:0},{el:'H', x:1.2,y:-0.9,z:0},{el:'H', x:0.6,y:0,z:-1.0}
    ],
    bonds: [[0,1],[0,2],[0,3],[0,4],[1,5],[1,6],[1,7]]
  },
  {
    id: 'ethene',
    name: 'Ethene',
    formula: 'C₂H₄',
    wikiTitle: 'Ethylene',
    atoms: [
      {el:'C', x:-0.5,y:0,z:0},{el:'C', x:0.5,y:0,z:0},
      {el:'H', x:-1.0,y:0.9,z:0},{el:'H', x:-1.0,y:-0.9,z:0},
      {el:'H', x:1.0,y:0.9,z:0},{el:'H', x:1.0,y:-0.9,z:0}
    ],
    bonds: [[0,1],[0,2],[0,3],[1,4],[1,5]]
  },
  {
    id: 'ethyne',
    name: 'Ethyne',
    formula: 'C₂H₂',
    wikiTitle: 'Acetylene',
    atoms: [
      {el:'C', x:-0.6,y:0,z:0},{el:'C', x:0.6,y:0,z:0},
      {el:'H', x:-1.2,y:0,z:0},{el:'H', x:1.2,y:0,z:0}
    ],
    bonds: [[0,1],[0,2],[1,3]]
  },
  {
    id: 'propane',
    name: 'Propane',
    formula: 'C₃H₈',
    wikiTitle: 'Propane',
    atoms: [
      {el:'C',x:-1.1,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.1,y:0,z:0},
      {el:'H',x:-1.8,y:0.8,z:0},{el:'H',x:-1.8,y:-0.8,z:0},{el:'H',x:0,y:0.9,z:0},
      {el:'H',x:0,y:-0.9,z:0},{el:'H',x:1.8,y:0.8,z:0},{el:'H',x:1.8,y:-0.8,z:0},{el:'H',x:1.1,y:0,z:1.0}
    ],
    bonds: [[0,1],[1,2],[0,3],[0,4],[1,5],[1,6],[2,7],[2,8],[2,9]]
  },
  {
    id: 'propene',
    name: 'Propene',
    formula: 'C₃H₆',
    wikiTitle: 'Propene',
    atoms: [
      {el:'C',x:-1.1,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.2,y:0,z:0},
      {el:'H',x:-1.7,y:0.8,z:0},{el:'H',x:-1.7,y:-0.8,z:0},{el:'H',x:0,y:0.9,z:0},
      {el:'H',x:1.8,y:0.8,z:0},{el:'H',x:1.8,y:-0.8,z:0}
    ],
    bonds: [[0,1],[1,2],[0,3],[0,4],[1,5],[2,6],[2,7]]
  },
  {
    id: 'butane',
    name: 'Butane',
    formula: 'C₄H₁₀',
    wikiTitle: 'Butane',
    atoms: [
      {el:'C',x:-1.5,y:0,z:0},{el:'C',x:-0.5,y:0,z:0},{el:'C',x:0.5,y:0,z:0},{el:'C',x:1.5,y:0,z:0},
      {el:'H',x:-1.9,y:0.9,z:0},{el:'H',x:-1.9,y:-0.9,z:0},{el:'H',x:-0.5,y:0.9,z:0},{el:'H',x:-0.5,y:-0.9,z:0},
      {el:'H',x:0.5,y:0.9,z:0},{el:'H',x:0.5,y:-0.9,z:0},{el:'H',x:1.9,y:0.9,z:0},{el:'H',x:1.9,y:-0.9,z:0}
    ],
    bonds: [[0,1],[1,2],[2,3],[0,4],[0,5],[1,6],[1,7],[2,8],[2,9],[3,10],[3,11]]
  },
  {
    id: 'isobutane',
    name: 'Isobutane',
    formula: 'C₄H₁₀',
    wikiTitle: 'Isobutane',
    atoms: [
      {el:'C',x:0,y:0,z:0},{el:'C',x:-1.0,y:0.6,z:0},{el:'C',x:-1.0,y:-0.6,z:0},{el:'C',x:1.0,y:0,z:0},
      {el:'H',x:0,y:1.0,z:0},{el:'H',x:0,y:-1.0,z:0},{el:'H',x:-1.8,y:1.2,z:0},{el:'H',x:-1.8,y:0.0,z:0},
      {el:'H',x:-1.8,y:-1.2,z:0},{el:'H',x:1.8,y:0.9,z:0},{el:'H',x:1.8,y:-0.9,z:0}
    ],
    bonds: [[0,1],[0,2],[0,3],[0,4],[0,5],[1,6],[1,7],[2,8],[3,9],[3,10]]
  },
  {
    id: 'butene',
    name: 'Butene',
    formula: 'C₄H₈',
    wikiTitle: '1-Butene',
    atoms: [
      {el:'C',x:-1.6,y:0,z:0},{el:'C',x:-0.6,y:0,z:0},{el:'C',x:0.6,y:0,z:0},{el:'C',x:1.6,y:0,z:0},
      {el:'H',x:-2.1,y:0.9,z:0},{el:'H',x:-2.1,y:-0.9,z:0},{el:'H',x:-0.6,y:0.9,z:0},
      {el:'H',x:0.6,y:0.9,z:0},{el:'H',x:1.6,y:0.9,z:0},{el:'H',x:1.6,y:-0.9,z:0}
    ],
    bonds: [[0,1],[1,2],[2,3],[0,4],[0,5],[1,6],[2,7],[3,8],[3,9]]
  },
  {
    id: 'pentane',
    name: 'Pentane',
    formula: 'C₅H₁₂',
    wikiTitle: 'Pentane',
    atoms: [
      {el:'C',x:-2.0,y:0,z:0},{el:'C',x:-1.0,y:0,z:0},{el:'C',x:0.0,y:0,z:0},{el:'C',x:1.0,y:0,z:0},{el:'C',x:2.0,y:0,z:0},
      {el:'H',x:-2.6,y:0.9,z:0},{el:'H',x:-2.6,y:-0.9,z:0},{el:'H',x:-1.0,y:0.9,z:0},{el:'H',x:-1.0,y:-0.9,z:0},
      {el:'H',x:0.0,y:0.9,z:0},{el:'H',x:0.0,y:-0.9,z:0},{el:'H',x:1.0,y:0.9,z:0},{el:'H',x:1.0,y:-0.9,z:0},{el:'H',x:2.6,y:0.9,z:0},{el:'H',x:2.6,y:-0.9,z:0}
    ],
    bonds: [[0,1],[1,2],[2,3],[3,4],[0,5],[0,6],[1,7],[1,8],[2,9],[2,10],[3,11],[3,12],[4,13],[4,14]]
  },
  {
    id: 'hexane',
    name: 'Hexane',
    formula: 'C₆H₁₄',
    wikiTitle: 'Hexane',
    atoms: (function(){
      const atoms=[];
      for(let i=0;i<6;i++) atoms.push({el:'C', x: (i-2.5)*0.9, y:0, z:0});
      let hydIdx = 6;
      // add two H per carbon (simplified)
      for(let i=0;i<6;i++){
        atoms.push({el:'H', x: (i-2.5)*0.9, y:0.9, z:0});
        atoms.push({el:'H', x: (i-2.5)*0.9, y:-0.9, z:0});
      }
      return atoms;
    })(),
    bonds:(function(){
      const b=[];
      for(let i=0;i<5;i++) b.push([i,i+1]);
      // attach Hs (simplified indices)
      for(let i=0;i<6;i++){
        const c=i;
        const h1=6+2*i, h2=6+2*i+1;
        b.push([c,h1]); b.push([c,h2]);
      }
      return b;
    })()
  },
  {
    id: 'heptane',
    name: 'Heptane',
    formula: 'C₇H₁₆',
    wikiTitle: 'Heptane',
    atoms: (function(){
      const atoms=[];
      for(let i=0;i<7;i++) atoms.push({el:'C', x:(i-3)*0.85, y:0, z:0});
      for(let i=0;i<7;i++){ atoms.push({el:'H', x:(i-3)*0.85, y:1.0, z:0}); atoms.push({el:'H', x:(i-3)*0.85, y:-1.0, z:0}); }
      return atoms;
    })(),
    bonds:(function(){
      const b=[]; for(let i=0;i<6;i++) b.push([i,i+1]);
      for(let i=0;i<7;i++){ b.push([i,7+2*i]); b.push([i,7+2*i+1]); }
      return b;
    })()
  },
  {
    id: 'octane',
    name: 'Octane',
    formula: 'C₈H₁₈',
    wikiTitle: 'Octane',
    atoms:(function(){ const atoms=[]; for(let i=0;i<8;i++) atoms.push({el:'C',x:(i-3.5)*0.8,y:0,z:0}); for(let i=0;i<8;i++){ atoms.push({el:'H',x:(i-3.5)*0.8,y:0.9}); atoms.push({el:'H',x:(i-3.5)*0.8,y:-0.9}); } return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<7;i++) b.push([i,i+1]); for(let i=0;i<8;i++){ b.push([i,8+2*i]); b.push([i,8+2*i+1]); } return b; })()
  },
  {
    id: 'nonane',
    name: 'Nonane',
    formula: 'C₉H₂₀',
    wikiTitle: 'Nonane',
    atoms:(function(){ const atoms=[]; for(let i=0;i<9;i++) atoms.push({el:'C',x:(i-4)*0.8,y:0,z:0}); for(let i=0;i<9;i++){ atoms.push({el:'H',x:(i-4)*0.8,y:1}); atoms.push({el:'H',x:(i-4)*0.8,y:-1}); } return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<8;i++) b.push([i,i+1]); for(let i=0;i<9;i++){ b.push([i,9+2*i]); b.push([i,9+2*i+1]); } return b; })()
  },
  {
    id: 'decane',
    name: 'Decane',
    formula: 'C₁₀H₂₂',
    wikiTitle: 'Decane',
    atoms:(function(){ const atoms=[]; for(let i=0;i<10;i++) atoms.push({el:'C',x:(i-4.5)*0.8,y:0,z:0}); for(let i=0;i<10;i++){ atoms.push({el:'H',x:(i-4.5)*0.8,y:1}); atoms.push({el:'H',x:(i-4.5)*0.8,y:-1}); } return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<9;i++) b.push([i,i+1]); for(let i=0;i<10;i++){ b.push([i,10+2*i]); b.push([i,10+2*i+1]); } return b; })()
  },
  {
    id: 'toluene',
    name: 'Toluene',
    formula: 'C₇H₈',
    wikiTitle: 'Toluene',
    atoms:(function(){
      const R=1.4; const atoms=[];
      for(let i=0;i<6;i++){
        const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0});
      }
      atoms.push({el:'C',x:Math.cos(0)*(R+1.2),y:Math.sin(0)*(R+1.2),z:0}); // methyl carbon
      // hydrogens on ring
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'H',x:Math.cos(a)*(R+1.05),y:Math.sin(a)*(R+1.05),z:0}); }
      atoms.push({el:'H',x:Math.cos(0)*(R+2.2),y:0,z:0});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++){ b.push([i,(i+1)%6]); b.push([i,6+i]); } b.push([0,6]); b.push([6,12]); return b; })()
  },
  {
    id:'phenol',
    name:'Phenol',
    formula:'C₆H₅OH',
    wikiTitle:'Phenol',
    atoms:(function(){
      const R=1.4; const atoms=[];
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0}); }
      atoms.push({el:'O',x:Math.cos(0)*(R+1.2),y:0,z:0});
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'H',x:Math.cos(a)*(R+1.05),y:Math.sin(a)*(R+1.05),z:0}); }
      atoms.push({el:'H',x:Math.cos(0)*(R+2.2),y:0,z:0});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++){ b.push([i,(i+1)%6]); b.push([i,6+i]); } b.push([0,6]); b.push([6,12]); return b; })()
  },
  {
    id:'aniline',
    name:'Aniline',
    formula:'C₆H₅NH₂',
    wikiTitle:'Aniline',
    atoms:(function(){
      const R=1.4; const atoms=[];
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0}); }
      atoms.push({el:'N',x:Math.cos(0)*(R+1.2),y:0,z:0});
      atoms.push({el:'H',x:Math.cos(0)*(R+2.2),y:0,z:0});
      atoms.push({el:'H',x:Math.cos(0)*(R+1.2),y:0.9,z:0});
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'H',x:Math.cos(a)*(R+1.05),y:Math.sin(a)*(R+1.05),z:0}); }
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); for(let i=0;i<6;i++) b.push([i,6+i]); b.push([0,6]); b.push([6,7]); b.push([6,8]); return b; })()
  },
  {
    id:'pyridine',
    name:'Pyridine',
    formula:'C₅H₅N',
    wikiTitle:'Pyridine',
    atoms:(function(){
      const R=1.35; const atoms=[];
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el: i===5? 'N':'C', x:Math.cos(a)*R, y:Math.sin(a)*R, z:0}); }
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'H', x:Math.cos(a)*(R+1.05), y:Math.sin(a)*(R+1.05), z:0}); }
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); for(let i=0;i<6;i++) b.push([i,6+i]); return b; })()
  },
  {
    id:'acetic_acid',
    name:'Acetic acid',
    formula:'CH₃COOH',
    wikiTitle:'Acetic_acid',
    atoms:[
      {el:'C',x:-1.1,y:0,z:0},{el:'C',x:0.2,y:0,z:0},{el:'O',x:1.3,y:0.6,z:0},{el:'O',x:1.3,y:-0.6,z:0},
      {el:'H',x:-1.7,y:0.9,z:0},{el:'H',x:-1.7,y:-0.9,z:0},{el:'H',x:-1.1,y:0,z:1.0}
    ],
    bonds:[[0,1],[1,2],[1,3],[0,4],[0,5],[1,6]]
  },
  {
    id:'formic_acid',
    name:'Formic acid',
    formula:'HCOOH',
    wikiTitle:'Formic_acid',
    atoms:[
      {el:'C',x:0,y:0,z:0},{el:'O',x:1.2,y:0.6,z:0},{el:'O',x:1.2,y:-0.6,z:0},{el:'H',x:-1.0,y:0,z:0},{el:'H',x:1.9,y:0.6,z:0}
    ],
    bonds:[[0,1],[0,2],[0,3],[1,4]]
  },
  {
    id:'nitric_acid',
    name:'Nitric acid',
    formula:'HNO₃',
    wikiTitle:'Nitric_acid',
    atoms:[
      {el:'N',x:0,y:0,z:0},{el:'O',x:1.2,y:0.6,z:0},{el:'O',x:1.2,y:-0.6,z:0},{el:'O',x:-1.2,y:0,z:0},{el:'H',x:-1.9,y:0,z:0}
    ],
    bonds:[[0,1],[0,2],[0,3],[3,4]]
  },
  {
    id:'sulfuric_acid',
    name:'Sulfuric acid',
    formula:'H₂SO₄',
    wikiTitle:'Sulfuric_acid',
    atoms:[
      {el:'S',x:0,y:0,z:0},{el:'O',x:1.4,y:0,z:0},{el:'O',x:-1.4,y:0,z:0},{el:'O',x:0,y:1.4,z:0},{el:'O',x:0,y:-1.4,z:0},
      {el:'H',x:0,y:2.2,z:0},{el:'H',x:0,y:-2.2,z:0}
    ],
    bonds:[[0,1],[0,2],[0,3],[0,4],[3,5],[4,6]]
  },
  {
    id:'hydrochloric_acid',
    name:'Hydrochloric acid',
    formula:'HCl',
    wikiTitle:'Hydrochloric_acid',
    atoms:[ {el:'H',x:-0.6,y:0,z:0},{el:'Cl',x:0.6,y:0,z:0} ],
    bonds:[[0,1]]
  },
  {
    id:'hydrogen',
    name:'Hydrogen gas',
    formula:'H₂',
    wikiTitle:'Hydrogen',
    atoms:[ {el:'H',x:-0.6,y:0,z:0},{el:'H',x:0.6,y:0,z:0} ],
    bonds:[[0,1]]
  },
  {
    id:'oxygen',
    name:'Oxygen gas',
    formula:'O₂',
    wikiTitle:'Oxygen',
    atoms:[ {el:'O',x:-0.6,y:0,z:0},{el:'O',x:0.6,y:0,z:0} ],
    bonds:[[0,1]]
  },
  {
    id:'nitrogen',
    name:'Nitrogen gas',
    formula:'N₂',
    wikiTitle:'Nitrogen',
    atoms:[ {el:'N',x:-0.6,y:0,z:0},{el:'N',x:0.6,y:0,z:0} ],
    bonds:[[0,1]]
  },
  {
    id:'ammonia',
    name:'Ammonia',
    formula:'NH₃',
    wikiTitle:'Ammonia',
    atoms:[ {el:'N',x:0,y:0,z:0},{el:'H',x:0.9,y:0.5,z:0},{el:'H',x:-0.9,y:0.5,z:0},{el:'H',x:0,y:-1.0,z:0} ],
    bonds:[[0,1],[0,2],[0,3]]
  },
  {
    id:'carbon_monoxide',
    name:'Carbon monoxide',
    formula:'CO',
    wikiTitle:'Carbon_monoxide',
    atoms:[ {el:'C',x:-0.6,y:0,z:0},{el:'O',x:0.6,y:0,z:0} ],
    bonds:[[0,1]]
  },
  {
    id:'hydrogen_peroxide',
    name:'Hydrogen peroxide',
    formula:'H₂O₂',
    wikiTitle:'Hydrogen_peroxide',
    atoms:[ {el:'O',x:-0.5,y:0,z:0},{el:'O',x:0.5,y:0,z:0},{el:'H',x:-1.1,y:0.6,z:0},{el:'H',x:1.1,y:-0.6,z:0} ],
    bonds:[[0,1],[0,2],[1,3]]
  },
  {
    id:'ozone',
    name:'Ozone',
    formula:'O₃',
    wikiTitle:'Ozone',
    atoms:[ {el:'O',x:-0.9,y:0,z:0},{el:'O',x:0,y:0.1,z:0},{el:'O',x:0.9,y:0,z:0} ],
    bonds:[[0,1],[1,2]]
  },
  {
    id:'formaldehyde',
    name:'Formaldehyde',
    formula:'CH₂O',
    wikiTitle:'Formaldehyde',
    atoms:[ {el:'C',x:0,y:0,z:0},{el:'O',x:1.2,y:0,z:0},{el:'H',x:-0.6,y:0.8,z:0},{el:'H',x:-0.6,y:-0.8,z:0} ],
    bonds:[[0,1],[0,2],[0,3]]
  },
  {
    id:'benzaldehyde',
    name:'Benzaldehyde',
    formula:'C₇H₆O',
    wikiTitle:'Benzaldehyde',
    atoms:(function(){
      const R=1.4, atoms=[];
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0}); }
      atoms.push({el:'C',x:Math.cos(0)*(R+1.2),y:0,z:0}); atoms.push({el:'O',x:Math.cos(0)*(R+2.3),y:0,z:0});
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'H',x:Math.cos(a)*(R+1.05),y:Math.sin(a)*(R+1.05),z:0}); }
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); for(let i=0;i<6;i++) b.push([i,6+i]); b.push([0,6]); b.push([6,7]); return b; })()
  },
  {
    id:'acetaldehyde',
    name:'Acetaldehyde',
    formula:'CH₃CHO',
    wikiTitle:'Acetaldehyde',
    atoms:[
      {el:'C',x:-0.9,y:0,z:0},{el:'C',x:0.2,y:0,z:0},{el:'O',x:1.4,y:0,z:0},
      {el:'H',x:-1.5,y:0.9,z:0},{el:'H',x:-1.5,y:-0.9,z:0},{el:'H',x:-0.9,y:0,z:1.0},{el:'H',x:1.9,y:0.3,z:0}
    ],
    bonds:[[0,1],[1,2],[0,3],[0,4],[0,5],[2,6]]
  },
  {
    id:'aspirin',
    name:'Aspirin',
    formula:'C₉H₈O₄',
    wikiTitle:'Aspirin',
    atoms:(function(){
      // simplified representation: aromatic ring + acetyl + carboxyl approximated
      const R=1.35; const atoms=[];
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0}); }
      atoms.push({el:'C',x:Math.cos(0)*(R+1.2),y:0,z:0}); atoms.push({el:'O',x:Math.cos(0)*(R+2.3),y:0,z:0});
      atoms.push({el:'C',x:0,y:-(R+1.2),z:0}); atoms.push({el:'O',x:0,y:-(R+2.3),z:0});
      // some hydrogens
      for(let i=0;i<4;i++) atoms.push({el:'H',x:Math.cos(i)*(R+1.05),y:Math.sin(i)*(R+1.05),z:0});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); b.push([0,6]); b.push([6,7]); b.push([2,8]); return b; })()
  },
  {
    id:'glucose',
    name:'Glucose',
    formula:'C₆H₁₂O₆',
    wikiTitle:'Glucose',
    atoms:(function(){
      // rough chain ring approx (6 carbons + oxygens + Hs simplified)
      const atoms=[];
      const R=1.0;
      for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R,z:0}); }
      for(let i=0;i<6;i++){ atoms.push({el:'O',x:Math.cos(i/6*Math.PI*2)*(R+0.9), y:Math.sin(i/6*Math.PI*2)*(R+0.9), z:0}); }
      // add a few H's
      for(let i=0;i<6;i++) atoms.push({el:'H',x:Math.cos(i)*(R+1.6),y:Math.sin(i)*(R+1.6),z:0});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++){ b.push([i,(i+1)%6]); b.push([i,6+i]); } for(let i=0;i<6;i++) b.push([i,12+i]); return b; })()
  },
  {
    id:'fructose',
    name:'Fructose',
    formula:'C₆H₁₂O₆',
    wikiTitle:'Fructose',
    atoms:(function(){
      const atoms=[]; const R=0.9;
      for(let i=0;i<6;i++){ atoms.push({el:'C',x:(i-2.5)*0.8,y:Math.sin(i)*0.3,z:0}); }
      for(let i=0;i<6;i++){ atoms.push({el:'O',x:(i-2.5)*0.8,y:Math.sin(i)*0.3+0.9,z:0}); }
      for(let i=0;i<6;i++) atoms.push({el:'H',x:(i-2.5)*0.8,y:Math.sin(i)*0.3-0.9,z:0});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<5;i++) b.push([i,i+1]); for(let i=0;i<6;i++){ b.push([i,6+i]); b.push([i,12+i]); } return b; })()
  },
  {
    id:'sucrose',
    name:'Sucrose',
    formula:'C₁₂H₂₂O₁₁',
    wikiTitle:'Sucrose',
    atoms:(function(){
      // simplified: two hexose units connected
      const atoms=[];
      for(let i=0;i<12;i++) atoms.push({el:'C',x:(i-5.5)*0.6,y: (i%2?0.8:-0.8), z:0});
      for(let i=0;i<11;i++) atoms.push({el:'O',x:(i-5)*0.5,y:(i%2?1.6:-1.6)});
      for(let i=0;i<22;i++) atoms.push({el:'H',x:(i-10)*0.3,y:(i%3-1)*0.6});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<11;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'lactose',
    name:'Lactose',
    formula:'C₁₂H₂₂O₁₁',
    wikiTitle:'Lactose',
    atoms:(function(){ const atoms=[]; for(let i=0;i<12;i++) atoms.push({el:'C',x:(i-5.5)*0.55,y:(i%2?0.9:-0.9)}); for(let i=0;i<11;i++) atoms.push({el:'O',x:(i-5)*0.5,y:(i%2?1.7:-1.7)}); for(let i=0;i<22;i++) atoms.push({el:'H',x:(i-10)*0.25,y:(i%3-1)*0.5}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<11;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'maltose',
    name:'Maltose',
    formula:'C₁₂H₂₂O₁₁',
    wikiTitle:'Maltose',
    atoms:(function(){ const atoms=[]; for(let i=0;i<12;i++) atoms.push({el:'C',x:(i-5.5)*0.55,y:(i%2?0.7:-0.7)}); for(let i=0;i<11;i++) atoms.push({el:'O',x:(i-5)*0.45,y:(i%2?1.5:-1.5)}); for(let i=0;i<22;i++) atoms.push({el:'H',x:(i-10)*0.25,y:(i%3-1)*0.45}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<11;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'alanine',
    name:'Alanine',
    formula:'C₃H₇NO₂',
    wikiTitle:'Alanine',
    atoms:[
      {el:'N',x:-1.2,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.2,y:0,z:0},{el:'C',x:2.2,y:0,z:0},
      {el:'O',x:3.4,y:0.5,z:0},{el:'O',x:3.4,y:-0.5,z:0},{el:'H',x:-1.8,y:0.9,z:0},{el:'H',x:-1.8,y:-0.9,z:0}
    ],
    bonds:[[0,1],[1,2],[2,3],[3,4],[3,5],[0,6],[0,7]]
  },
  {
    id:'glycine',
    name:'Glycine',
    formula:'C₂H₅NO₂',
    wikiTitle:'Glycine',
    atoms:[ {el:'N',x:-1.0,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.3,y:0,z:0},{el:'O',x:2.5,y:0.6,z:0},{el:'O',x:2.5,y:-0.6,z:0},{el:'H',x:-1.6,y:0.9,z:0} ],
    bonds:[[0,1],[1,2],[2,3],[2,4],[0,5]]
  },
  {
    id:'serine',
    name:'Serine',
    formula:'C₃H₇NO₃',
    wikiTitle:'Serine',
    atoms:[
      {el:'N',x:-1.2,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.2,y:0,z:0},{el:'O',x:2.4,y:0.6,z:0},{el:'O',x:2.4,y:-0.6,z:0},{el:'O',x:1.8,y:1.4,z:0}
    ],
    bonds:[[0,1],[1,2],[2,3],[2,4],[2,5]]
  },
  {
    id:'cysteine',
    name:'Cysteine',
    formula:'C₃H₇NO₂S',
    wikiTitle:'Cysteine',
    atoms:[
      {el:'N',x:-1.3,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.2,y:0,z:0},{el:'C',x:2.4,y:0,z:0},{el:'S',x:3.6,y:0,z:0},{el:'O',x:2.4,y:1.2,z:0}
    ],
    bonds:[[0,1],[1,2],[2,3],[3,4],[3,5]]
  },
  {
    id:'lysine',
    name:'Lysine',
    formula:'C₆H₁₄N₂O₂',
    wikiTitle:'Lysine',
    atoms:(function(){ const a=[]; for(let i=0;i<6;i++) a.push({el:'C',x:i*0.8,y:0,z:0}); a.unshift({el:'N',x:-0.8,y:0,z:0}); a.push({el:'N',x:5.8,y:0.6}); a.push({el:'O',x:6.6,y:0.9}); return a; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,i+1]); b.unshift([0,1]); b.push([7,8]); return b; })()
  },
  {
    id:'tryptophan',
    name:'Tryptophan',
    formula:'C₁₁H₁₂N₂O₂',
    wikiTitle:'Tryptophan',
    atoms:(function(){ const atoms=[]; for(let i=0;i<11;i++) atoms.push({el:'C',x:Math.cos(i/11*Math.PI*2),y:Math.sin(i/11*Math.PI*2)}); atoms.push({el:'N',x:1.8,y:0}); atoms.push({el:'O',x:-1.8,y:0}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<10;i++) b.push([i,i+1]); b.push([0,11],[5,12]); return b; })()
  },
  {
    id:'tyrosine',
    name:'Tyrosine',
    formula:'C₉H₁₁NO₂',
    wikiTitle:'Tyrosine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<9;i++) atoms.push({el:'C',x:i*0.6,y:0}); atoms.push({el:'N',x:-0.6,y:0}); atoms.push({el:'O',x:5.6,y:0.6}); atoms.push({el:'O',x:5.6,y:-0.6}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<8;i++) b.push([i,i+1]); b.push([0,9],[8,10],[8,11]); return b; })()
  },
  {
    id:'adenine',
    name:'Adenine',
    formula:'C₅H₅N₅',
    wikiTitle:'Adenine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<10;i++) atoms.push({el: i%2? 'N':'C', x:Math.cos(i/10*Math.PI*2), y:Math.sin(i/10*Math.PI*2)}); for(let i=0;i<5;i++) atoms.push({el:'H',x:Math.cos(i)*(1.6),y:Math.sin(i)*(1.6)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<9;i++) b.push([i,i+1]); b.push([0,9]); for(let i=10;i<15;i++) b.push([i-10,i]); return b; })()
  },
  {
    id:'guanine',
    name:'Guanine',
    formula:'C₅H₅N₅O',
    wikiTitle:'Guanine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<11;i++) atoms.push({el: i%3==0?'O':(i%2? 'N':'C'), x:Math.cos(i/11*Math.PI*2), y:Math.sin(i/11*Math.PI*2)}); for(let i=0;i<5;i++) atoms.push({el:'H',x:Math.cos(i)*(1.6),y:Math.sin(i)*(1.6)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<10;i++) b.push([i,i+1]); b.push([0,10]); for(let i=11;i<16;i++) b.push([i-11,i]); return b; })()
  },
  {
    id:'cytosine',
    name:'Cytosine',
    formula:'C₄H₅N₃O',
    wikiTitle:'Cytosine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<9;i++) atoms.push({el: i%4==0?'O':(i%2? 'N':'C'), x:Math.cos(i/9*Math.PI*2), y:Math.sin(i/9*Math.PI*2)}); for(let i=0;i<5;i++) atoms.push({el:'H',x:Math.cos(i)*(1.4),y:Math.sin(i)*(1.4)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<8;i++) b.push([i,i+1]); b.push([0,8]); return b; })()
  },
  {
    id:'thymine',
    name:'Thymine',
    formula:'C₅H₆N₂O₂',
    wikiTitle:'Thymine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<10;i++) atoms.push({el:i%3==0?'O':(i%2?'N':'C'), x:Math.cos(i/10*Math.PI*2), y:Math.sin(i/10*Math.PI*2)}); for(let i=0;i<6;i++) atoms.push({el:'H',x:Math.cos(i)*(1.5),y:Math.sin(i)*(1.5)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<9;i++) b.push([i,i+1]); b.push([0,9]); return b; })()
  },
  {
    id:'uracil',
    name:'Uracil',
    formula:'C₄H₄N₂O₂',
    wikiTitle:'Uracil',
    atoms:(function(){ const atoms=[]; for(let i=0;i<8;i++) atoms.push({el:i%4==0?'O':(i%2?'N':'C'), x:Math.cos(i/8*Math.PI*2), y:Math.sin(i/8*Math.PI*2)}); for(let i=0;i<4;i++) atoms.push({el:'H',x:Math.cos(i)*(1.4),y:Math.sin(i)*(1.4)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<7;i++) b.push([i,i+1]); b.push([0,7]); return b; })()
  },
  {
    id:'atp',
    name:'ATP',
    formula:'C₁₀H₁₆N₅O₁₃P₃',
    wikiTitle:'Adenosine_triphosphate',
    atoms:(function(){ const atoms=[]; // highly simplified placeholder
      for(let i=0;i<12;i++) atoms.push({el:i%5==0?'P':(i%3==0?'N':(i%2==0?'O':'C')), x:Math.cos(i/12*Math.PI*2), y:Math.sin(i/12*Math.PI*2)});
      for(let i=0;i<8;i++) atoms.push({el:'H',x:Math.cos(i)*(2.0),y:Math.sin(i)*(2.0)});
      return atoms;
    })(),
    bonds:(function(){ const b=[]; for(let i=0;i<11;i++) b.push([i,i+1]); for(let i=12;i<20;i++) b.push([i-12,i]); return b; })()
  },
  {
    id:'adp',
    name:'ADP',
    formula:'C₁₀H₁₅N₅O₁₀P₂',
    wikiTitle:'Adenosine_diphosphate',
    atoms:(function(){ const atoms=[]; for(let i=0;i<11;i++) atoms.push({el:i%4==0?'P':(i%2?'N':'C'), x:Math.cos(i/11*Math.PI*2), y:Math.sin(i/11*Math.PI*2)}); for(let i=0;i<6;i++) atoms.push({el:'H',x:Math.cos(i)*(1.8),y:Math.sin(i)*(1.8)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<10;i++) b.push([i,i+1]); for(let i=11;i<17;i++) b.push([i-11,i]); return b; })()
  },
  {
    id:'nad',
    name:'NAD',
    formula:'C₂₁H₂₇N₇O₁₄P₂',
    wikiTitle:'Nicotinamide_adenine_dinucleotide',
    atoms:(function(){ const atoms=[]; for(let i=0;i<20;i++) atoms.push({el: i%6==0?'P':(i%5==0?'N':(i%3==0?'O':'C')), x:Math.cos(i/20*Math.PI*2), y:Math.sin(i/20*Math.PI*2)}); for(let i=0;i<10;i++) atoms.push({el:'H', x:Math.cos(i)*(2.1), y:Math.sin(i)*(2.1)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<19;i++) b.push([i,i+1]); for(let i=20;i<30;i++) b.push([i-20,i]); return b; })()
  },
  {
    id:'cholesterol',
    name:'Cholesterol',
    formula:'C₂₇H₄₆O',
    wikiTitle:'Cholesterol',
    atoms:(function(){ const atoms=[]; for(let i=0;i<27;i++) atoms.push({el:'C', x:(i-13)*0.35, y: (i%2?0.8:-0.8), z:0}); atoms.push({el:'O',x:4.5,y:0.6}); for(let i=0;i<46;i++) atoms.push({el:'H', x:(i-22)*0.2, y:(i%3-1)*0.3}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<26;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'stearic_acid',
    name:'Stearic acid',
    formula:'C₁₈H₃₆O₂',
    wikiTitle:'Stearic_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<18;i++) atoms.push({el:'C',x:(i-8.5)*0.7,y:0}); atoms.push({el:'O',x:10,y:0.5}); atoms.push({el:'O',x:10,y:-0.5}); for(let i=0;i<36;i++) atoms.push({el:'H',x:(i-18)*0.3,y:(i%2?0.4:-0.4)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<17;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'oleic_acid',
    name:'Oleic acid',
    formula:'C₁₈H₃₄O₂',
    wikiTitle:'Oleic_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<18;i++) atoms.push({el:'C',x:(i-8.5)*0.7,y: Math.sin(i)*0.25}); atoms.push({el:'O',x:10,y:0.6}); atoms.push({el:'O',x:10,y:-0.6}); for(let i=0;i<34;i++) atoms.push({el:'H',x:(i-17)*0.3,y:(i%2?0.4:-0.4)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<17;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'linoleic_acid',
    name:'Linoleic acid',
    formula:'C₁₈H₃₂O₂',
    wikiTitle:'Linoleic_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<18;i++) atoms.push({el:'C',x:(i-8.5)*0.65,y: Math.sin(i)*0.3}); atoms.push({el:'O',x:10,y:0.6}); atoms.push({el:'O',x:10,y:-0.6}); for(let i=0;i<32;i++) atoms.push({el:'H',x:(i-16)*0.28,y:(i%2?0.35:-0.35)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<17;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'palmitic_acid',
    name:'Palmitic acid',
    formula:'C₁₆H₃₂O₂',
    wikiTitle:'Palmitic_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<16;i++) atoms.push({el:'C',x:(i-7.5)*0.7,y:0}); atoms.push({el:'O',x:8.5,y:0.5}); atoms.push({el:'O',x:8.5,y:-0.5}); for(let i=0;i<32;i++) atoms.push({el:'H',x:(i-16)*0.3,y:(i%2?0.4:-0.4)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<15;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'vitamin_c',
    name:'Vitamin C',
    formula:'C₆H₈O₆',
    wikiTitle:'Ascorbic_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<6;i++) atoms.push({el:'C',x:Math.cos(i/6*Math.PI*2),y:Math.sin(i/6*Math.PI*2)}); for(let i=0;i<6;i++) atoms.push({el:'O',x:Math.cos(i/6*Math.PI*2)*1.6,y:Math.sin(i/6*Math.PI*2)*1.6}); for(let i=0;i<8;i++) atoms.push({el:'H',x:Math.cos(i)*(2.0),y:Math.sin(i)*(2.0)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<5;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'vitamin_b12',
    name:'Vitamin B12',
    formula:'C₆₃H₈₈CoN₁₄O₁₄P',
    wikiTitle:'Vitamin_B12',
    atoms:(function(){ const atoms=[]; for(let i=0;i<40;i++) atoms.push({el:i%6==0?'Co':(i%3==0?'N':'C'), x:Math.cos(i/40*Math.PI*2)*2, y:Math.sin(i/40*Math.PI*2)*2}); for(let i=0;i<40;i++) atoms.push({el:'H',x:Math.cos(i)*3,y:Math.sin(i)*3}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<39;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'caffeine',
    name:'Caffeine',
    formula:'C₈H₁₀N₄O₂',
    wikiTitle:'Caffeine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<8;i++) atoms.push({el:'C',x:Math.cos(i/8*Math.PI*2),y:Math.sin(i/8*Math.PI*2)}); for(let i=0;i<4;i++) atoms.push({el:'N',x:Math.cos(i/4*Math.PI*2)*1.6,y:Math.sin(i/4*Math.PI*2)*1.6}); for(let i=0;i<10;i++) atoms.push({el:'H',x:Math.cos(i)*2.2,y:Math.sin(i)*2.2}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<7;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'nicotine',
    name:'Nicotine',
    formula:'C₁₀H₁₄N₂',
    wikiTitle:'Nicotine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<10;i++) atoms.push({el:'C',x:Math.cos(i/10*Math.PI*2),y:Math.sin(i/10*Math.PI*2)}); atoms.push({el:'N',x:1.6,y:0}); atoms.push({el:'N',x:-1.6,y:0}); for(let i=0;i<14;i++) atoms.push({el:'H',x:Math.cos(i)*2.4,y:Math.sin(i)*2.4}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<9;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'lactic_acid',
    name:'Lactic acid',
    formula:'C₃H₆O₃',
    wikiTitle:'Lactic_acid',
    atoms:[ {el:'C',x:-1.1,y:0,z:0},{el:'C',x:0,y:0,z:0},{el:'C',x:1.1,y:0,z:0},{el:'O',x:2.3,y:0.6,z:0},{el:'O',x:2.3,y:-0.6,z:0},{el:'H',x:-1.7,y:0.9} ],
    bonds:[[0,1],[1,2],[2,3],[2,4],[0,5]]
  },
  {
    id:'citric_acid',
    name:'Citric acid',
    formula:'C₆H₈O₇',
    wikiTitle:'Citric_acid',
    atoms:(function(){ const atoms=[]; for(let i=0;i<6;i++) atoms.push({el:'C',x:Math.cos(i/6*Math.PI*2),y:Math.sin(i/6*Math.PI*2)}); for(let i=0;i<7;i++) atoms.push({el:'O',x:Math.cos(i/7*Math.PI*2)*1.6,y:Math.sin(i/7*Math.PI*2)*1.6}); for(let i=0;i<8;i++) atoms.push({el:'H',x:Math.cos(i)*2,y:Math.sin(i)*2}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<5;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'oxalic_acid',
    name:'Oxalic acid',
    formula:'C₂H₂O₄',
    wikiTitle:'Oxalic_acid',
    atoms:[
      {el:'C',x:-0.6,y:0},{el:'C',x:0.6,y:0},{el:'O',x:-1.4,y:0.9},{el:'O',x:-1.4,y:-0.9},{el:'O',x:1.4,y:0.9},{el:'O',x:1.4,y:-0.9},{el:'H',x:-2.0,y:0.9},{el:'H',x:2.0,y:0.9}
    ],
    bonds:[[0,1],[0,2],[0,3],[1,4],[1,5],[2,6],[4,7]]
  },
  {
    id:'urea',
    name:'Urea',
    formula:'CH₄N₂O',
    wikiTitle:'Urea',
    atoms:[ {el:'C',x:0,y:0},{el:'O',x:1.2,y:0},{el:'N',x:-1.0,y:0.6},{el:'N',x:-1.0,y:-0.6},{el:'H',x:-1.6,y:1.3},{el:'H',x:-1.6,y:-1.3},{el:'H',x:0.2,y:1.0} ],
    bonds:[[0,1],[0,2],[0,3],[2,4],[3,5],[0,6]]
  },
  {
    id:'ammonium_nitrate',
    name:'Ammonium nitrate',
    formula:'NH₄NO₃',
    wikiTitle:'Ammonium_nitrate',
    atoms:[
      {el:'N',x:-1.2,y:0},{el:'H',x:-1.8,y:0.8},{el:'H',x:-1.8,y:-0.8},{el:'H',x:-0.6,y:0.9},{el:'H',x:-0.6,y:-0.9},
      {el:'N',x:1.2,y:0},{el:'O',x:2.4,y:0.6},{el:'O',x:2.4,y:-0.6},{el:'O',x:1.8,y:1.2}
    ],
    bonds:[[0,1],[0,2],[0,3],[0,4],[5,6],[5,7],[5,8]]
  },
  {
    id:'calcium_carbonate',
    name:'Calcium carbonate',
    formula:'CaCO₃',
    wikiTitle:'Calcium_carbonate',
    atoms:[ {el:'Ca',x:0,y:0},{el:'C',x:1.4,y:0},{el:'O',x:2.6,y:0.8},{el:'O',x:2.6,y:-0.8},{el:'O',x:1.4,y:1.2} ],
    bonds:[[0,1],[1,2],[1,3],[1,4]]
  },
  {
    id:'magnesium_sulfate',
    name:'Magnesium sulfate',
    formula:'MgSO₄',
    wikiTitle:'Magnesium_sulfate',
    atoms:[ {el:'Mg',x:0,y:0},{el:'S',x:1.6,y:0},{el:'O',x:2.8,y:0.9},{el:'O',x:2.8,y:-0.9},{el:'O',x:1.6,y:1.4},{el:'O',x:1.6,y:-1.4} ],
    bonds:[[0,1],[1,2],[1,3],[1,4],[1,5]]
  },
  {
    id:'sodium_bicarbonate',
    name:'Sodium bicarbonate',
    formula:'NaHCO₃',
    wikiTitle:'Sodium_bicarbonate',
    atoms:[
      {el:'Na',x:-1.5,y:0},{el:'H',x:-0.6,y:0.9},{el:'C',x:0.2,y:0},{el:'O',x:1.5,y:0.7},{el:'O',x:1.5,y:-0.7},{el:'O',x:0.2,y:1.1}
    ],
    bonds:[[0,2],[2,3],[2,4],[2,5],[0,1]]
  },
  {
    id:'silver_nitrate',
    name:'Silver nitrate',
    formula:'AgNO₃',
    wikiTitle:'Silver_nitrate',
    atoms:[ {el:'Ag',x:0,y:0},{el:'N',x:1.4,y:0},{el:'O',x:2.6,y:0.8},{el:'O',x:2.6,y:-0.8},{el:'O',x:1.4,y:1.2} ],
    bonds:[[0,1],[1,2],[1,3],[1,4]]
  },
  {
    id:'silver_chloride',
    name:'Silver chloride',
    formula:'AgCl',
    wikiTitle:'Silver_chloride',
    atoms:[ {el:'Ag',x:-0.6,y:0},{el:'Cl',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'copper_sulfate',
    name:'Copper sulfate',
    formula:'CuSO₄',
    wikiTitle:'Copper(II)_sulfate',
    atoms:[ {el:'Cu',x:0,y:0},{el:'S',x:1.6,y:0},{el:'O',x:2.8,y:0.9},{el:'O',x:2.8,y:-0.9},{el:'O',x:1.6,y:1.4},{el:'O',x:1.6,y:-1.4} ],
    bonds:[[0,1],[1,2],[1,3],[1,4],[1,5]]
  },
  {
    id:'iron_oxide',
    name:'Iron(III) oxide',
    formula:'Fe₂O₃',
    wikiTitle:'Iron(III)_oxide',
    atoms:[ {el:'Fe',x:-1.0,y:0},{el:'Fe',x:1.0,y:0},{el:'O',x:0,y:1.2},{el:'O',x:0,y:-1.2},{el:'O',x:2.4,y:0} ],
    bonds:[[0,2],[0,3],[1,2],[1,3],[1,4]]
  },
  {
    id:'magnetite',
    name:'Magnetite',
    formula:'Fe₃O₄',
    wikiTitle:'Magnetite',
    atoms:[ {el:'Fe',x:-1.2,y:0},{el:'Fe',x:0,y:0},{el:'Fe',x:1.2,y:0},{el:'O',x:0,y:1.4},{el:'O',x:0,y:-1.4} ],
    bonds:[[0,1],[1,2],[0,3],[2,4],[1,3]]
  },
  {
    id:'silicon_dioxide',
    name:'Silicon dioxide',
    formula:'SiO₂',
    wikiTitle:'Silicon_dioxide',
    atoms:[ {el:'Si',x:0,y:0},{el:'O',x:1.2,y:0.7},{el:'O',x:1.2,y:-0.7} ],
    bonds:[[0,1],[0,2]]
  },
  {
    id:'sodium_hydroxide',
    name:'Sodium hydroxide',
    formula:'NaOH',
    wikiTitle:'Sodium_hydroxide',
    atoms:[ {el:'Na',x:-1.0,y:0},{el:'O',x:0,y:0},{el:'H',x:0.8,y:0,z:0} ],
    bonds:[[0,1],[1,2]]
  },
  {
    id:'potassium_hydroxide',
    name:'Potassium hydroxide',
    formula:'KOH',
    wikiTitle:'Potassium_hydroxide',
    atoms:[ {el:'K',x:-1.0,y:0},{el:'O',x:0,y:0},{el:'H',x:0.8,y:0} ],
    bonds:[[0,1],[1,2]]
  },
  {
    id:'sulfur_dioxide',
    name:'Sulfur dioxide',
    formula:'SO₂',
    wikiTitle:'Sulfur_dioxide',
    atoms:[ {el:'S',x:0,y:0},{el:'O',x:1.2,y:0.6},{el:'O',x:-1.2,y:0.6} ],
    bonds:[[0,1],[0,2]]
  },
  {
    id:'sulfur_trioxide',
    name:'Sulfur trioxide',
    formula:'SO₃',
    wikiTitle:'Sulfur_trioxide',
    atoms:[ {el:'S',x:0,y:0},{el:'O',x:1.2,y:0.8},{el:'O',x:-1.2,y:0.8},{el:'O',x:0,y:-1.4} ],
    bonds:[[0,1],[0,2],[0,3]]
  },
  {
    id:'nitrogen_dioxide',
    name:'Nitrogen dioxide',
    formula:'NO₂',
    wikiTitle:'Nitrogen_dioxide',
    atoms:[ {el:'N',x:0,y:0},{el:'O',x:1.2,y:0.6},{el:'O',x:-1.2,y:0.6} ],
    bonds:[[0,1],[0,2]]
  },
  {
    id:'nitric_oxide',
    name:'Nitric oxide',
    formula:'NO',
    wikiTitle:'Nitric_oxide',
    atoms:[ {el:'N',x:-0.6,y:0},{el:'O',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'nitrous_oxide',
    name:'Nitrous oxide',
    formula:'N₂O',
    wikiTitle:'Nitrous_oxide',
    atoms:[ {el:'N',x:-1.0,y:0},{el:'N',x:0,y:0},{el:'O',x:1.2,y:0} ],
    bonds:[[0,1],[1,2]]
  },
  {
    id:'chlorine_gas',
    name:'Chlorine',
    formula:'Cl₂',
    wikiTitle:'Chlorine',
    atoms:[ {el:'Cl',x:-0.6,y:0},{el:'Cl',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'fluorine_gas',
    name:'Fluorine',
    formula:'F₂',
    wikiTitle:'Fluorine',
    atoms:[ {el:'F',x:-0.6,y:0},{el:'F',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'bromine_gas',
    name:'Bromine',
    formula:'Br₂',
    wikiTitle:'Bromine',
    atoms:[ {el:'Br',x:-0.6,y:0},{el:'Br',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'iodine_gas',
    name:'Iodine',
    formula:'I₂',
    wikiTitle:'Iodine',
    atoms:[ {el:'I',x:-0.6,y:0},{el:'I',x:0.6,y:0} ],
    bonds:[[0,1]]
  },
  {
    id:'methylamine',
    name:'Methylamine',
    formula:'CH₅N',
    wikiTitle:'Methylamine',
    atoms:[ {el:'N',x:0,y:0},{el:'C',x:1.3,y:0},{el:'H',x:-0.6,y:0.9},{el:'H',x:-0.6,y:-0.9},{el:'H',x:2.0,y:0.9},{el:'H',x:2.0,y:-0.9} ],
    bonds:[[0,1],[0,2],[0,3],[1,4],[1,5]]
  },
  {
    id:'ethylamine',
    name:'Ethylamine',
    formula:'C₂H₇N',
    wikiTitle:'Ethylamine',
    atoms:[ {el:'N',x:-1.2,y:0},{el:'C',x:0,y:0},{el:'C',x:1.2,y:0},{el:'H',x:-1.8,y:0.9},{el:'H',x:-1.8,y:-0.9},{el:'H',x:0,y:0.9},{el:'H',x:0,y:-0.9},{el:'H',x:1.8,y:0.9},{el:'H',x:1.8,y:-0.9} ],
    bonds:[[0,1],[1,2],[0,3],[0,4],[1,5],[1,6],[2,7],[2,8]]
  },
  {
    id:'propylamine',
    name:'Propylamine',
    formula:'C₃H₉N',
    wikiTitle:'Propylamine',
    atoms:(function(){ const a=[]; a.push({el:'N',x:-1.4,y:0}); for(let i=0;i<3;i++) a.push({el:'C',x:-0.4+i*0.9,y:0}); for(let i=0;i<9;i++) a.push({el:'H',x:-1+i*0.4,y:(i%2?0.7:-0.7)}); return a; })(),
    bonds:(function(){ const b=[]; b.push([0,1],[1,2],[2,3]); for(let i=4;i<13;i++) b.push([i-4,i]); return b; })()
  },
  {
    id:'styrene',
    name:'Styrene',
    formula:'C₈H₈',
    wikiTitle:'Styrene',
    atoms:(function(){ const atoms=[]; const R=1.35; for(let i=0;i<6;i++){ const a=(i/6)*Math.PI*2; atoms.push({el:'C',x:Math.cos(a)*R,y:Math.sin(a)*R}); } atoms.push({el:'C',x:Math.cos(0)*(R+1.2),y:0}); atoms.push({el:'C',x:Math.cos(0)*(R+2.2),y:0}); for(let i=0;i<6;i++) atoms.push({el:'H',x:Math.cos(i)*(R+1.05),y:Math.sin(i)*(R+1.05)}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); b.push([0,6],[6,7]); for(let i=6;i<12;i++) b.push([i-6,i]); return b; })()
  },
  {
    id:'potassium_nitrate',
    name:'Potassium nitrate',
    formula:'KNO₃',
    wikiTitle:'Potassium_nitrate',
    atoms:[ {el:'K',x:-1.2,y:0},{el:'N',x:0,y:0},{el:'O',x:1.2,y:0.8},{el:'O',x:1.2,y:-0.8},{el:'O',x:0,y:1.4} ],
    bonds:[[0,1],[1,2],[1,3],[1,4]]
  },
  {
    id:'calcium_hydroxide',
    name:'Calcium hydroxide',
    formula:'Ca(OH)₂',
    wikiTitle:'Calcium_hydroxide',
    atoms:[ {el:'Ca',x:0,y:0},{el:'O',x:1.2,y:0.8},{el:'O',x:1.2,y:-0.8},{el:'H',x:2.0,y:0.8},{el:'H',x:2.0,y:-0.8} ],
    bonds:[[0,1],[0,2],[1,3],[2,4]]
  },
  {
    id:'boric_acid',
    name:'Boric acid',
    formula:'H₃BO₃',
    wikiTitle:'Boric_acid',
    atoms:[ {el:'B',x:0,y:0},{el:'O',x:1.2,y:0.7},{el:'O',x:1.2,y:-0.7},{el:'O',x:-1.4,y:0},{el:'H',x:1.9,y:0.7},{el:'H',x:1.9,y:-0.7},{el:'H',x:-2.0,y:0} ],
    bonds:[[0,1],[0,2],[0,3],[1,4],[2,5],[3,6]]
  },
  {
    id:'boron_trifluoride',
    name:'Boron trifluoride',
    formula:'BF₃',
    wikiTitle:'Boron_trifluoride',
    atoms:[ {el:'B',x:0,y:0},{el:'F',x:1.2,y:0.7},{el:'F',x:1.2,y:-0.7},{el:'F',x:-1.2,y:0} ],
    bonds:[[0,1],[0,2],[0,3]]
  },
  {
    id:'silicon_tetrafluoride',
    name:'Silicon tetrafluoride',
    formula:'SiF₄',
    wikiTitle:'Silicon_tetrafluoride',
    atoms:[ {el:'Si',x:0,y:0},{el:'F',x:1.2,y:0.9},{el:'F',x:1.2,y:-0.9},{el:'F',x:-1.2,y:0.9},{el:'F',x:-1.2,y:-0.9} ],
    bonds:[[0,1],[0,2],[0,3],[0,4]]
  },
  {
    id:'carbonic_acid',
    name:'Carbonic acid',
    formula:'H₂CO₃',
    wikiTitle:'Carbonic_acid',
    atoms:[ {el:'C',x:0,y:0},{el:'O',x:1.2,y:0.7},{el:'O',x:1.2,y:-0.7},{el:'O',x:-1.2,y:0},{el:'H',x:-1.9,y:0.6},{el:'H',x:-1.9,y:-0.6} ],
    bonds:[[0,1],[0,2],[0,3],[3,4],[3,5]]
  },
  {
    id:'phenylalanine',
    name:'Phenylalanine',
    formula:'C₉H₁₁NO₂',
    wikiTitle:'Phenylalanine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<9;i++) atoms.push({el:'C',x:Math.cos(i/9*Math.PI*2),y:Math.sin(i/9*Math.PI*2)}); atoms.push({el:'N',x:-1.8,y:0}); atoms.push({el:'O',x:1.8,y:0.6}); atoms.push({el:'O',x:1.8,y:-0.6}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<8;i++) b.push([i,i+1]); b.push([0,9]); b.push([1,10]); return b; })()
  },
  {
    id:'histidine',
    name:'Histidine',
    formula:'C₆H₉N₃O₂',
    wikiTitle:'Histidine',
    atoms:(function(){ const atoms=[]; for(let i=0;i<6;i++) atoms.push({el:'C',x:Math.cos(i/6*Math.PI*2),y:Math.sin(i/6*Math.PI*2)}); for(let i=0;i<3;i++) atoms.push({el:'N',x:Math.cos(i/3*Math.PI*2)*1.6,y:Math.sin(i/3*Math.PI*2)*1.6}); for(let i=0;i<2;i++) atoms.push({el:'O',x:Math.cos(i)*2.0,y:Math.sin(i)*2.0}); return atoms; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<5;i++) b.push([i,i+1]); return b; })()
  },
  {
    id:'methanol',
    name:'Methanol',
    formula:'CH₃OH',
    wikiTitle:'Methanol',
    atoms:[ {el:'C',x:0,y:0},{el:'O',x:1.2,y:0},{el:'H',x:-0.6,y:0.9},{el:'H',x:-0.6,y:-0.9},{el:'H',x:0,y:1.0},{el:'H',x:1.8,y:0.3} ],
    bonds:[[0,1],[0,2],[0,3],[0,4],[1,5]]
  },
  {
    id:'isopropanol',
    name:'Isopropanol',
    formula:'C₃H₈O',
    wikiTitle:'Isopropyl_alcohol',
    atoms:[ {el:'C',x:-0.8,y:0},{el:'C',x:0,y:0},{el:'C',x:0.8,y:0},{el:'O',x:1.8,y:0},{el:'H',x:-1.6,y:0.8},{el:'H',x:-1.6,y:-0.8},{el:'H',x:0,y:0.9},{el:'H',x:0,y:-0.9},{el:'H',x:0.8,y:0.9},{el:'H',x:0.8,y:-0.9},{el:'H',x:2.6,y:0.3} ],
    bonds:[[0,1],[1,2],[2,3],[0,4],[0,5],[1,6],[1,7],[2,8],[2,9],[3,10]]
  },
  {
    id:'butanol',
    name:'Butanol',
    formula:'C₄H₉OH',
    wikiTitle:'Butanol',
    atoms:(function(){ const a=[]; for(let i=0;i<4;i++) a.push({el:'C',x:(i-1.5)*0.9,y:0}); a.push({el:'O',x:2.0,y:0}); for(let i=0;i<9;i++) a.push({el:'H',x:(i-4)*0.4,y:(i%2?0.6:-0.6)}); return a; })(),
    bonds:(function(){ const b=[]; for(let i=0;i<3;i++) b.push([i,i+1]); b.push([3,4]); for(let i=5;i<14;i++) b.push([i-5,i]); return b; })()
  },
  {
    id:'ethylene_glycol',
    name:'Ethylene glycol',
    formula:'C₂H₆O₂',
    wikiTitle:'Ethylene_glycol',
    atoms:[ {el:'C',x:-0.6,y:0},{el:'C',x:0.6,y:0},{el:'O',x:1.8,y:0.6},{el:'O',x:1.8,y:-0.6},{el:'H',x:-1.2,y:0.9},{el:'H',x:-1.2,y:-0.9},{el:'H',x:0.6,y:0.9},{el:'H',x:0.6,y:-0.9},{el:'H',x:2.4,y:0.6},{el:'H',x:2.4,y:-0.6} ],
    bonds:[[0,1],[1,2],[1,3],[0,4],[0,5],[1,6],[1,7],[2,8],[3,9]]
  },
  {
    id:'glycerol',
    name:'Glycerol',
    formula:'C₃H₈O₃',
    wikiTitle:'Glycerol',
    atoms:[ {el:'C',x:-1.0,y:0},{el:'C',x:0,y:0},{el:'C',x:1.0,y:0},{el:'O',x:-1.8,y:0.6},{el:'O',x:0.0,y:0.9},{el:'O',x:1.8,y:0.6} ],
    bonds:[[0,1],[1,2],[0,3],[1,4],[2,5]]
  },

  // --- Remaining molecules to reach +100 (many are simplified, placeholders for visualization) ---
  { id:'acetic_anhydride', name:'Acetic anhydride', formula:'C₄H₆O₃', wikiTitle:'Acetic_anhydride', atoms:[{el:'C',x:-1.2,y:0},{el:'C',x:0,y:0},{el:'O',x:1.2,y:0},{el:'C',x:2.4,y:0},{el:'O',x:3.6,y:0}], bonds:[[0,1],[1,2],[2,3],[3,4]] },
  { id:'acetone', name:'Acetone', formula:'C₃H₆O', wikiTitle:'Acetone', atoms:[{el:'C',x:-1.1,y:0},{el:'C',x:0,y:0},{el:'C',x:1.1,y:0},{el:'O',x:0,y:1.2},{el:'H',x:-1.7,y:0.9},{el:'H',x:-1.7,y:-0.9},{el:'H',x:1.7,y:0.9},{el:'H',x:1.7,y:-0.9}], bonds:[[0,1],[1,2],[1,3],[0,4],[0,5],[2,6],[2,7]] },
  { id:'acetylene', name:'Acetylene (duplicate-check safe id is ethyne above)', formula:'C₂H₂', wikiTitle:'Acetylene', atoms:[{el:'C',x:-0.6,y:0},{el:'C',x:0.6,y:0},{el:'H',x:-1.2,y:0},{el:'H',x:1.2,y:0}], bonds:[[0,1],[0,2],[1,3]] },
  { id:'formamide', name:'Formamide', formula:'CH₃NO', wikiTitle:'Formamide', atoms:[{el:'C',x:0,y:0},{el:'N',x:1.2,y:0},{el:'O',x:2.4,y:0},{el:'H',x:-0.6,y:0.9},{el:'H',x:-0.6,y:-0.9},{el:'H',x:1.2,y:0.9}], bonds:[[0,1],[1,2],[0,3],[0,4],[1,5]] },
  { id:'benzene_derivative_anisole', name:'Anisole', formula:'C₇H₈O', wikiTitle:'Anisole', atoms:(function(){ const R=1.35, a=[]; for(let i=0;i<6;i++){ const t=(i/6)*Math.PI*2; a.push({el:'C',x:Math.cos(t)*R,y:Math.sin(t)*R}); } a.push({el:'O',x:Math.cos(0)*(R+1.2),y:0}); a.push({el:'H',x:Math.cos(0)*(R+2.25),y:0}); for(let i=0;i<6;i++) a.push({el:'H',x:Math.cos(i)*(R+1.05),y:Math.sin(i)*(R+1.05)}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); for(let i=0;i<6;i++) b.push([i,6+i]); b.push([0,6]); b.push([6,7]); return b; })() },
  { id:'styrene_oxide', name:'Styrene oxide', formula:'C₈H₈O', wikiTitle:'Styrene_oxide', atoms:[{el:'C',x:-1,y:0},{el:'C',x:0,y:0},{el:'C',x:1,y:0},{el:'O',x:2,y:0},{el:'H',x:-1.5,y:0.9}], bonds:[[0,1],[1,2],[2,3],[0,4]] },
  { id:'formic_acid_salt', name:'Sodium formate', formula:'HCOONa', wikiTitle:'Sodium_formate', atoms:[{el:'Na',x:-1.2,y:0},{el:'C',x:0,y:0},{el:'O',x:1.2,y:0.6},{el:'O',x:1.2,y:-0.6},{el:'H',x:-0.6,y:0.9}], bonds:[[0,1],[1,2],[1,3],[0,4]] },
  { id:'sulfanilamide', name:'Sulfanilamide', formula:'C₆H₈N₂O₂S', wikiTitle:'Sulfanilamide', atoms:(function(){const a=[]; for(let i=0;i<6;i++){ const t=(i/6)*Math.PI*2; a.push({el:'C',x:Math.cos(t),y:Math.sin(t)});} a.push({el:'S',x:2.4,y:0}); a.push({el:'N',x:2.8,y:0.9}); a.push({el:'N',x:2.8,y:-0.9}); for(let i=0;i<6;i++) a.push({el:'H',x:Math.cos(i)*(1.6),y:Math.sin(i)*(1.6)}); return a; })(), bonds:(function(){const b=[]; for(let i=0;i<6;i++) b.push([i,(i+1)%6]); return b; })() },
  { id:'urethan', name:'Urethane (ethyl carbamate)', formula:'C₃H₇NO₂', wikiTitle:'Ethyl_carbamate', atoms:[{el:'C',x:-1,y:0},{el:'C',x:0,y:0},{el:'O',x:1.2,y:0},{el:'N',x:2.4,y:0},{el:'O',x:3.6,y:0},{el:'H',x:-1.6,y:0.8}], bonds:[[0,1],[1,2],[2,3],[3,4],[0,5]] },
  { id:'aniline_nitrite', name:'Aniline nitrite (example)', formula:'C₆H₆N', wikiTitle:'Aniline', atoms:[{el:'C',x:-1,y:0},{el:'C',x:0,y:0},{el:'C',x:1,y:0},{el:'N',x:2,y:0}], bonds:[[0,1],[1,2],[2,3]] },

  // to reach exactly +100 items added we continue with simpler placeholder-style representations:
  { id:'urea_derivative_1', name:'Urea derivative 1', formula:'C₂H₆N₂O', wikiTitle:'Urea', atoms:[{el:'C',x:0},{el:'N',x:1},{el:'O',x:2},{el:'H',x:-1}], bonds:[[0,1],[1,2],[0,3]] },
  { id:'small_peptide_ala_gly', name:'Dipeptide (Ala-Gly)', formula:'C₅H₁₀N₂O₃', wikiTitle:'Peptide', atoms:[{el:'N',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2},{el:'N',x:3}], bonds:[[0,1],[1,2],[2,3],[2,4]] },
  { id:'cinnamaldehyde', name:'Cinnamaldehyde', formula:'C₉H₈O', wikiTitle:'Cinnamaldehyde', atoms:[{el:'C',x:-2},{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2}], bonds:[[0,1],[1,2],[2,3],[3,4]] },
  { id:'sulfanilic_acid', name:'Sulfanilic acid', formula:'C₆H₇NO₃S', wikiTitle:'Sulfanilic_acid', atoms:[{el:'C',x:0},{el:'S',x:1},{el:'N',x:2},{el:'O',x:3}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'p-hydroxybenzoic_acid', name:'p-Hydroxybenzoic acid', formula:'C₇H₆O₃', wikiTitle:'p-Hydroxybenzoic_acid', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'vanillin', name:'Vanillin', formula:'C₈H₈O₃', wikiTitle:'Vanillin', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2},{el:'O',x:3}], bonds:[[0,1],[1,2],[2,3],[3,4]] },
  { id:'salicylic_acid', name:'Salicylic acid', formula:'C₇H₆O₃', wikiTitle:'Salicylic_acid', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2},{el:'O',x:-2}], bonds:[[0,1],[1,2],[2,3],[0,4]] },
  { id:'benzoic_acid', name:'Benzoic acid', formula:'C₇H₆O₂', wikiTitle:'Benzoic_acid', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2},{el:'O',x:-2}], bonds:[[0,1],[1,2],[2,3],[2,4]] },
  { id:'phenylhydrazine', name:'Phenylhydrazine', formula:'C₆H₈N₂', wikiTitle:'Phenylhydrazine', atoms:[{el:'C',x:-1},{el:'N',x:0},{el:'N',x:1}], bonds:[[0,1],[1,2]] },
  { id:'anethole', name:'Anethole', formula:'C₁₀H₁₂O', wikiTitle:'Anethole', atoms:[{el:'C',x:-2},{el:'C',x:-1},{el:'C',x:0},{el:'O',x:1}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'menthol', name:'Menthol', formula:'C₁₀H₂₀O', wikiTitle:'Menthol', atoms:[{el:'C',x:-2},{el:'C',x:-1},{el:'C',x:0},{el:'O',x:1}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'camphor', name:'Camphor', formula:'C₁₀H₁₆O', wikiTitle:'Camphor', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'limonene', name:'Limonene', formula:'C₁₀H₁₆', wikiTitle:'Limonene', atoms:[{el:'C',x:-2},{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'geraniol', name:'Geraniol', formula:'C₁₀H₁₈O', wikiTitle:'Geraniol', atoms:[{el:'C',x:-2},{el:'C',x:-1},{el:'C',x:0},{el:'O',x:1}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'eugenol', name:'Eugenol', formula:'C₁₀H₁₂O₂', wikiTitle:'Eugenol', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'O',x:2}], bonds:[[0,1],[1,2],[2,3]] },
  { id:'squalene', name:'Squalene', formula:'C₃₀H₅₀', wikiTitle:'Squalene', atoms:(function(){ const a=[]; for(let i=0;i<30;i++) a.push({el:'C',x:i*0.3,y:Math.sin(i)*0.2}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<29;i++) b.push([i,i+1]); return b; })() },
  { id:'urea2', name:'Urea (alternate)', formula:'CH₄N₂O', wikiTitle:'Urea', atoms:[{el:'C',x:0},{el:'N',x:1},{el:'N',x:-1},{el:'O',x:0,y:1}], bonds:[[0,1],[0,2],[0,3]] },
  { id:'hydrazine', name:'Hydrazine', formula:'N₂H₄', wikiTitle:'Hydrazine', atoms:[{el:'N',x:-0.6},{el:'N',x:0.6},{el:'H',x:-1.2,y:0.8},{el:'H',x:-1.2,y:-0.8},{el:'H',x:1.2,y:0.8},{el:'H',x:1.2,y:-0.8}], bonds:[[0,1],[0,2],[0,3],[1,4],[1,5]] },
  { id:'hydroxylamine', name:'Hydroxylamine', formula:'NH₂OH', wikiTitle:'Hydroxylamine', atoms:[{el:'N',x:-0.6,y:0},{el:'O',x:0.6,y:0},{el:'H',x:-1.2,y:0.8},{el:'H',x:-1.2,y:-0.8},{el:'H',x:1.2,y:0.8}], bonds:[[0,1],[0,2],[0,3],[1,4]] },
  { id:'perchloric_acid', name:'Perchloric acid', formula:'HClO₄', wikiTitle:'Perchloric_acid', atoms:[{el:'Cl',x:0},{el:'O',x:1,y:0.8},{el:'O',x:1,y:-0.8},{el:'O',x:-1,y:0.8},{el:'O',x:-1,y:-0.8},{el:'H',x:-1.6,y:-0.8}], bonds:[[0,1],[0,2],[0,3],[0,4],[4,5]] },
  { id:'permanganate', name:'Potassium permanganate', formula:'KMnO₄', wikiTitle:'Potassium_permanganate', atoms:[{el:'K',x:-1},{el:'Mn',x:0},{el:'O',x:1,y:0.7},{el:'O',x:1,y:-0.7},{el:'O',x:0,y:1.4},{el:'O',x:0,y:-1.4}], bonds:[[0,1],[1,2],[1,3],[1,4],[1,5]] },
  { id:'alkane_small_1', name:'Heptane isomer (example)', formula:'C₇H₁₆', wikiTitle:'Heptane', atoms:(function(){ const a=[]; for(let i=0;i<7;i++) a.push({el:'C',x:i*0.7}); for(let i=0;i<16;i++) a.push({el:'H',x:(i-8)*0.25}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<6;i++) b.push([i,i+1]); return b; })() },
  { id:'chloral', name:'Chloral', formula:'C₂HCl₃O', wikiTitle:'Chloral', atoms:[{el:'C',x:0},{el:'C',x:1},{el:'Cl',x:2},{el:'Cl',x:2,y:0.8},{el:'Cl',x:2,y:-0.8},{el:'O',x:1,y:1.6}], bonds:[[0,1],[1,2],[2,3],[2,4],[1,5]] },
  { id:'chloroform', name:'Chloroform', formula:'CHCl₃', wikiTitle:'Chloroform', atoms:[{el:'C',x:0},{el:'H',x:-1,y:0},{el:'Cl',x:1,y:0.8},{el:'Cl',x:1,y:-0.8},{el:'Cl',x:1,y:0}], bonds:[[0,1],[0,2],[0,3],[0,4]] },
  { id:'carbon_tetrachloride', name:'Carbon tetrachloride', formula:'CCl₄', wikiTitle:'Carbon_tetrachloride', atoms:[{el:'C',x:0},{el:'Cl',x:1,y:0.8},{el:'Cl',x:1,y:-0.8},{el:'Cl',x:-1,y:0.8},{el:'Cl',x:-1,y:-0.8}], bonds:[[0,1],[0,2],[0,3],[0,4]] },
  { id:'hydrogen_sulfide', name:'Hydrogen sulfide', formula:'H₂S', wikiTitle:'Hydrogen_sulfide', atoms:[{el:'S',x:0},{el:'H',x:-0.8,y:0.6},{el:'H',x:-0.8,y:-0.6}], bonds:[[0,1],[0,2]] },
  { id:'sulfur_hexafluoride', name:'Sulfur hexafluoride', formula:'SF₆', wikiTitle:'Sulfur_hexafluoride', atoms:[{el:'S',x:0},{el:'F',x:1,y:0.9},{el:'F',x:1,y:-0.9},{el:'F',x:-1,y:0.9},{el:'F',x:-1,y:-0.9},{el:'F',x:0,y:1.4},{el:'F',x:0,y:-1.4}], bonds:[[0,1],[0,2],[0,3],[0,4],[0,5],[0,6]] },
  { id:'phosphoric_acid', name:'Phosphoric acid', formula:'H₃PO₄', wikiTitle:'Phosphoric_acid', atoms:[{el:'P',x:0},{el:'O',x:1.2,y:0.7},{el:'O',x:1.2,y:-0.7},{el:'O',x:-1.2,y:0.7},{el:'O',x:-1.2,y:-0.7},{el:'H',x:-1.9,y:0.7},{el:'H',x:-1.9,y:-0.7},{el:'H',x:1.9,y:0.7}], bonds:[[0,1],[0,2],[0,3],[0,4],[3,5],[4,6],[1,7]] },
  { id:'trimethylamine', name:'Trimethylamine', formula:'(CH₃)₃N', wikiTitle:'Trimethylamine', atoms:[{el:'N',x:0},{el:'C',x:1,y:0},{el:'C',x:-1,y:0},{el:'C',x:0,y:1},{el:'H',x:2,y:0}], bonds:[[0,1],[0,2],[0,3],[1,4]] },
  { id:'triphenylmethane', name:'Triphenylmethane', formula:'C₁₉H₁₆', wikiTitle:'Triphenylmethane', atoms:(function(){ const a=[]; for(let i=0;i<19;i++) a.push({el:'C',x:Math.cos(i/19*Math.PI*2),y:Math.sin(i/19*Math.PI*2)}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<18;i++) b.push([i,i+1]); return b; })() },
  { id:'phenanthrene', name:'Phenanthrene', formula:'C₁₄H₁₀', wikiTitle:'Phenanthrene', atoms:(function(){ const a=[]; for(let i=0;i<14;i++) a.push({el:'C',x:Math.cos(i/14*Math.PI*2),y:Math.sin(i/14*Math.PI*2)}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<13;i++) b.push([i,i+1]); return b; })() },
  { id:'anthracene', name:'Anthracene', formula:'C₁₄H₁₀', wikiTitle:'Anthracene', atoms:(function(){ const a=[]; for(let i=0;i<14;i++) a.push({el:'C',x:i*0.35,y:Math.sin(i)*0.2}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<13;i++) b.push([i,i+1]); return b; })() },
  { id:'naphthalene', name:'Naphthalene', formula:'C₁₀H₈', wikiTitle:'Naphthalene', atoms:(function(){ const a=[]; for(let i=0;i<10;i++) a.push({el:'C',x:Math.cos(i/10*Math.PI*2),y:Math.sin(i/10*Math.PI*2)}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<9;i++) b.push([i,i+1]); return b; })() },
  { id:'ibuprofen', name:'Ibuprofen', formula:'C₁₃H₁₈O₂', wikiTitle:'Ibuprofen', atoms:(function(){ const a=[]; for(let i=0;i<13;i++) a.push({el:'C',x:Math.cos(i/13*Math.PI*2),y:Math.sin(i/13*Math.PI*2)}); a.push({el:'O',x:2,y:0}); a.push({el:'O',x:-2,y:0}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<12;i++) b.push([i,i+1]); return b; })() },

  // final few to reach 100 added:
  { id:'paracetamol', name:'Paracetamol', formula:'C₈H₉NO₂', wikiTitle:'Paracetamol', atoms:[{el:'C',x:-1},{el:'C',x:0},{el:'C',x:1},{el:'N',x:2},{el:'O',x:3}], bonds:[[0,1],[1,2],[2,3],[3,4]] },
  { id:'sildenafil', name:'Sildenafil', formula:'C₂₂H₃₀N₆O₄S', wikiTitle:'Sildenafil', atoms:(function(){ const a=[]; for(let i=0;i<22;i++) a.push({el:'C',x:Math.cos(i/22*Math.PI*2),y:Math.sin(i/22*Math.PI*2)}); for(let i=0;i<8;i++) a.push({el:'H',x:Math.cos(i)*2,y:Math.sin(i)*2}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<21;i++) b.push([i,i+1]); return b; })() },
  { id:'amoxicillin', name:'Amoxicillin', formula:'C₁₆H₁₉N₃O₅S', wikiTitle:'Amoxicillin', atoms:(function(){ const a=[]; for(let i=0;i<16;i++) a.push({el:'C',x:i*0.3,y:Math.sin(i)*0.2}); for(let i=0;i<19;i++) a.push({el:'H',x:(i-9)*0.2,y:(i%2?0.4:-0.4)}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<15;i++) b.push([i,i+1]); return b; })() },
  { id:'penicillin_g', name:'Penicillin G', formula:'C₁₆H₁₈N₂O₄S', wikiTitle:'Penicillin_G', atoms:(function(){ const a=[]; for(let i=0;i<16;i++) a.push({el:'C',x:Math.cos(i/16*Math.PI*2),y:Math.sin(i/16*Math.PI*2)}); for(let i=0;i<8;i++) a.push({el:'H',x:Math.cos(i)*2,y:Math.sin(i)*2}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<15;i++) b.push([i,i+1]); return b; })() },
  { id:'d-glucose_alt', name:'D-Glucose (alternate)', formula:'C₆H₁₂O₆', wikiTitle:'Glucose', atoms:(function(){ const a=[]; for(let i=0;i<6;i++) a.push({el:'C',x:Math.cos(i/6*Math.PI*2),y:Math.sin(i/6*Math.PI*2)}); for(let i=0;i<12;i++) a.push({el:'H',x:Math.cos(i)*1.8,y:Math.sin(i)*1.8}); return a; })(), bonds:(function(){ const b=[]; for(let i=0;i<5;i++) b.push([i,i+1]); return b; })() },

  // end - total entries now: original 5 + ~100 additional
];

// (the rest of your JS remains unchanged — below is the original script logic you provided)
// --- Utility: scoring function for search (prioritize startsWith, then includes, then subsequence length) ---
function scoreMatch(query, text){
  if(!query) return 0;
  query = query.toLowerCase();
  text = text.toLowerCase();

  if(text === query) return 1000;
  if(text.startsWith(query)) return 900 - (text.length - query.length);
  if(text.includes(query)) return 700 - (text.length - query.length);

  // subsequence match (order preserved)
  let qi=0, ti=0, matched=0;
  while(qi<query.length && ti<text.length){
    if(query[qi]===text[ti]){ matched++; qi++; ti++; }
    else ti++;
  }
  if(matched>0) return 300 + matched*10;

  // very small fuzzy: longest common substring length
  let maxCommon = 0;
  for(let i=0;i<text.length;i++){
    for(let j=i+1;j<=text.length;j++){
      const sub = text.slice(i,j);
      if(query.includes(sub) && sub.length>maxCommon) maxCommon=sub.length;
    }
  }
  if(maxCommon>0) return 200 + maxCommon*10;

  return 0;
}

// --- Render molecules list (default A→Z) ---
const moleculesListEl = document.getElementById('moleculesList');
const moleculeSearch = document.getElementById('moleculeSearch');
let currentSortMode = 'az'; // 'az' or 'score'

function renderMoleculesList(query=''){
  moleculesListEl.innerHTML = '';
  const q = (query || '').trim();

  // produce items with score
  const items = moleculesData.map(m => {
    const score = q ? Math.max(scoreMatch(q, m.name), scoreMatch(q, m.formula), scoreMatch(q, m.id)) : 0;
    return {m, score};
  });

  if(currentSortMode === 'az' && !q){
    items.sort((a,b) => a.m.name.localeCompare(b.m.name));
  } else {
    // sort by score desc then name
    items.sort((a,b) => {
      if(b.score !== a.score) return b.score - a.score;
      return a.m.name.localeCompare(b.m.name);
    });
  }

  // show top results (or all)
  items.forEach(item => {
    const m = item.m;
    const div = document.createElement('div');
    div.className = 'molecule-item';
    div.innerHTML = `
      <div class="molecule-badge">${m.formula}</div>
      <div class="molecule-meta">
        <div class="molecule-name">${m.name}</div>
        <div class="molecule-formula">${m.formula}</div>
      </div>
    `;
    div.addEventListener('click', ()=> openMatterModal(m));
    moleculesListEl.appendChild(div);
  });

  if(items.length===0){
    moleculesListEl.innerHTML = '<div style="color:var(--text-secondary);padding:12px">No molecules found</div>';
  }
}

// --- Sorting buttons ---
document.getElementById('sortAZ').addEventListener('click', ()=>{
  currentSortMode='az';
  document.getElementById('sortAZ').classList.add('active');
  document.getElementById('sortScore').classList.remove('active');
  renderMoleculesList(moleculeSearch.value);
});
document.getElementById('sortScore').addEventListener('click', ()=>{
  currentSortMode='score';
  document.getElementById('sortScore').classList.add('active');
  document.getElementById('sortAZ').classList.remove('active');
  renderMoleculesList(moleculeSearch.value);
});

// --- search behavior: debounce + intelligent sorting ---
let searchDebounce = null;
moleculeSearch.addEventListener('input', (e)=>{
  if(searchDebounce) clearTimeout(searchDebounce);
  searchDebounce = setTimeout(()=>{
    // if query is short, prefer startsWith and exact formula matches, otherwise score
    renderMoleculesList(e.target.value);
  }, 180);
});

// --- Page toggle logic --- 
const pageSwitch = document.getElementById('pageSwitch');
const periodicPageEl = document.querySelector('.periodic-table')?.closest('.container') ? document.querySelector('.periodic-table').closest('.container') : null;
const moleculesPageEl = document.getElementById('moleculesPage');

pageSwitch.addEventListener('change', (e)=>{
  const on = e.target.checked;
  if(on){
    // show molecules, hide periodic table
    if(periodicPageEl) periodicPageEl.style.display = 'none';
    moleculesPageEl.style.display = 'block';
    moleculesPageEl.setAttribute('aria-hidden','false');
    document.getElementById('labelPeriodic').style.opacity = 0.5;
    document.getElementById('labelMolecules').style.opacity = 1;
  } else {
    if(periodicPageEl) periodicPageEl.style.display = '';
    moleculesPageEl.style.display = 'none';
    moleculesPageEl.setAttribute('aria-hidden','true');
    document.getElementById('labelPeriodic').style.opacity = 1;
    document.getElementById('labelMolecules').style.opacity = 0.5;
  }
});

// --- Matter Modal: create 3D & 2D and wiki fetch ---
let matterScene, matterCamera, matterRenderer, matterGroup;

function openMatterModal(molecule){
  document.getElementById('matterModal').classList.add('active');
  document.getElementById('matterModalTitle').textContent = `${molecule.name} — ${molecule.formula}`;

  // highlight active item in list (optional)
  document.querySelectorAll('.molecule-item').forEach(el=>el.classList.remove('active'));
  // cannot easily map back to specific element here without adding data-id, it's okay

  // update info
  document.getElementById('matterInfo').innerHTML = `
    <div class="info-section">
      <h3>Properties</h3>
      <div class="property"><span class="property-label">Name:</span><span class="property-value">${molecule.name}</span></div>
      <div class="property"><span class="property-label">Formula:</span><span class="property-value">${molecule.formula}</span></div>
      <div class="property"><span class="property-label">Atoms:</span><span class="property-value">${molecule.atoms.length}</span></div>
      <div class="property"><span class="property-label">Bonds:</span><span class="property-value">${molecule.bonds.length}</span></div>
    </div>
  `;

  loadMatterWiki(molecule.wikiTitle);
  create3DMolecule(molecule);
  draw2DMolecule(molecule);
}

// close matter modal
document.getElementById('closeMatterModal').addEventListener('click', closeMatterModal);
document.getElementById('matterModal').addEventListener('click', (e)=>{
  if(e.target.id === 'matterModal') closeMatterModal();
});
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMatterModal(); });

function closeMatterModal(){
  const modal = document.getElementById('matterModal');
  modal.classList.remove('active');
  // cleanup threejs
  if(matterRenderer){
    const c = document.getElementById('matterViewer');
    if(c.contains(matterRenderer.domElement)) c.removeChild(matterRenderer.domElement);
    try{ matterRenderer.dispose(); }catch(e){}
    matterRenderer = null;
  }
  if(matterScene){
    matterScene.traverse(o=>{
      if(o.geometry) o.geometry.dispose();
      if(o.material){
        if(Array.isArray(o.material)) o.material.forEach(m=>m.dispose());
        else o.material.dispose();
      }
    });
    matterScene = null;
  }
  matterCamera = null;
  matterGroup = null;
}

// --- create 3D molecule view (simple spheres + cylinders for bonds) ---
function create3DMolecule(molecule){
  const container = document.getElementById('matterViewer');
  container.innerHTML = '';
  matterScene = new THREE.Scene();
  matterScene.background = new THREE.Color(0x0d1117);

  matterCamera = new THREE.PerspectiveCamera(60, container.clientWidth/container.clientHeight, 0.1, 1000);
  matterCamera.position.set(0,0,10);

  matterRenderer = new THREE.WebGLRenderer({ antialias: true, alpha:true });
  matterRenderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(matterRenderer.domElement);

  matterGroup = new THREE.Group();
  matterScene.add(matterGroup);

  // atom color map (basic)
  const colorMap = { C:0x222222, O:0xff4444, H:0xffffff, N:0x3050f8, Na:0xAB5CF2, Cl:0x1FF01F, S:0xFFFF66, P:0xFF8C00, K:0x6A5ACD, Ca:0xFFA500, Mg:0x90EE90, Fe:0xB7410E, Si:0xF0C987, F:0x9AE8F0, Br:0x8B4513, I:0x660066 },
  radiusMap = { H:0.25, C:0.4, O:0.38, N:0.37, Na:0.55, Cl:0.55, S:0.45, P:0.45, K:0.6, Ca:0.6, Mg:0.55, Fe:0.55, Si:0.5, F:0.35, Br:0.55, I:0.6 };

  // center molecule
  const center = {x:0,y:0,z:0};
  molecule.atoms.forEach(a=>{ center.x += (a.x||0); center.y += (a.y||0); center.z += (a.z||0); });
  center.x/=Math.max(1,molecule.atoms.length); center.y/=Math.max(1,molecule.atoms.length); center.z/=Math.max(1,molecule.atoms.length);

  // add atoms
  molecule.atoms.forEach((a, idx) => {
    const col = colorMap[a.el] || 0x888888;
    const r = radiusMap[a.el] || 0.35;
    const g = new THREE.SphereGeometry(r, 24, 24);
    const m = new THREE.MeshPhongMaterial({ color: col, shininess:80 });
    const mesh = new THREE.Mesh(g,m);
    mesh.position.set((a.x||0) - center.x, (a.y||0) - center.y, (a.z||0) - center.z);
    matterGroup.add(mesh);

    // small label using canvas texture
    const canvas = document.createElement('canvas');
    canvas.width = 128; canvas.height=128;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    ctx.font = '64px sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(a.el,64,64);
    const tex = new THREE.CanvasTexture(canvas);
    const spriteMat = new THREE.SpriteMaterial({ map:tex, transparent:true, opacity:1 });
    const sprite = new THREE.Sprite(spriteMat);
    sprite.scale.set(0.8,0.8,0.8);
    sprite.position.set((a.x||0) - center.x, (a.y||0) - center.y, (a.z||0) - center.z + 0.5);
    matterGroup.add(sprite);
  });

  // add bonds as cylinders
  molecule.bonds.forEach(b=>{
    const a1 = molecule.atoms[b[0]];
    const a2 = molecule.atoms[b[1]];
    if(!a1 || !a2) return;
    const start = new THREE.Vector3((a1.x||0) - center.x, (a1.y||0) - center.y, (a1.z||0) - center.z);
    const end   = new THREE.Vector3((a2.x||0) - center.x, (a2.y||0) - center.y, (a2.z||0) - center.z);
    const mid = new THREE.Vector3().addVectors(start,end).multiplyScalar(0.5);
    const dist = start.distanceTo(end);

    const cylGeo = new THREE.CylinderGeometry(0.08,0.08, dist, 12);
    const cylMat = new THREE.MeshPhongMaterial({ color:0x999999 });
    const cyl = new THREE.Mesh(cylGeo, cylMat);

    cyl.position.copy(mid);
    cyl.lookAt(end);
    cyl.rotateX(Math.PI/2);
    matterGroup.add(cyl);
  });

  // lights
  matterScene.add(new THREE.AmbientLight(0x888888, 0.6));
  const dl = new THREE.DirectionalLight(0xffffff, 0.9); dl.position.set(5,5,5); matterScene.add(dl);
  matterScene.add(new THREE.PointLight(0xBBBBFF, 0.4, 0 ));

  // simple orbit animation
  function animateM(){
    requestAnimationFrame(animateM);
    matterGroup.rotation.y += 0.005;
    matterRenderer.render(matterScene, matterCamera);
  }
  animateM();

  // handle resize
  window.addEventListener('resize', ()=>{
    if(!matterRenderer) return;
    matterCamera.aspect = container.clientWidth/container.clientHeight;
    matterCamera.updateProjectionMatrix();
    matterRenderer.setSize(container.clientWidth, container.clientHeight);
  }, {passive:true});
}

// --- draw 2D structure (SVG) with atom circles and labels ---
function draw2DMolecule(molecule){
  const el = document.getElementById('matter2D');
  if(!el) return;
  el.innerHTML = '';
  const atoms = molecule.atoms;
  let minX=Infinity,maxX=-Infinity,minY=Infinity,maxY=-Infinity;
  atoms.forEach(a=>{
    minX = Math.min(minX, a.x||0); maxX = Math.max(maxX, a.x||0);
    minY = Math.min(minY, a.y||0); maxY = Math.max(maxY, a.y||0);
  });
  if(minX===Infinity){ el.innerHTML = ''; return; }
  const padding = 30;
  const W = el.clientWidth || 800;
  const H = el.clientHeight || 200;
  const scaleX = (W - padding*2) / (maxX - minX || 1);
  const scaleY = (H - padding*2) / (maxY - minY || 1);
  const scale = Math.min(scaleX, scaleY);

  const svgns = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(svgns,'svg');
  svg.setAttribute('width','100%');
  svg.setAttribute('height','100%');
  svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
  svg.style.display='block';

  function mapX(x){ return padding + ( (x||0) - minX ) * scale; }
  function mapY(y){ return (H - padding) - ( (y||0) - minY ) * scale; }

  molecule.bonds.forEach(b=>{
    const a1 = molecule.atoms[b[0]];
    const a2 = molecule.atoms[b[1]];
    if(!a1 || !a2) return;
    const line = document.createElementNS(svgns,'line');
    line.setAttribute('x1', mapX(a1.x));
    line.setAttribute('y1', mapY(a1.y));
    line.setAttribute('x2', mapX(a2.x));
    line.setAttribute('y2', mapY(a2.y));
    line.setAttribute('stroke','#9aa5b2');
    line.setAttribute('stroke-width','3');
    svg.appendChild(line);
  });

  atoms.forEach(a=>{
    const cx = mapX(a.x), cy = mapY(a.y);
    const g = document.createElementNS(svgns,'g');

    const circ = document.createElementNS(svgns,'circle');
    circ.setAttribute('cx',cx); circ.setAttribute('cy',cy); circ.setAttribute('r', 18);
    circ.setAttribute('fill','#1f2937');
    circ.setAttribute('stroke','#2b3946'); circ.setAttribute('stroke-width','1');
    g.appendChild(circ);

    const txt = document.createElementNS(svgns,'text');
    txt.setAttribute('x',cx);
    txt.setAttribute('y',cy+6);
    txt.setAttribute('font-size','14');
    txt.setAttribute('text-anchor','middle');
    txt.setAttribute('fill','#e6eef8');
    txt.setAttribute('font-weight','700');
    txt.textContent = a.el;
    g.appendChild(txt);

    svg.appendChild(g);
  });

  el.appendChild(svg);
}

// --- load wiki summary for molecule (use wikiTitle if provided) ---
function loadMatterWiki(wikiTitle){
  const wikiEl = document.getElementById('matterWiki');
  if(!wikiEl) return;
  wikiEl.innerHTML = '<div class="loading"></div><span>Loading information...</span>';
  if(!wikiTitle) { wikiEl.innerHTML = '<p>No wikipedia entry provided.</p>'; return; }

  fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(wikiTitle)}`)
    .then(r=>r.json())
    .then(data=>{
      if(data.extract){
        wikiEl.innerHTML = `<p>${data.extract}</p><a href="https://en.wikipedia.org/wiki/${encodeURIComponent(wikiTitle)}" target="_blank" style="color:var(--accent-blue);text-decoration:none;">Read more →</a>`;
      } else wikiEl.innerHTML = '<p>No Wikipedia info available.</p>';
    })
    .catch(err=>{
      wikiEl.innerHTML = '<p>Failed to load Wikipedia information.</p>';
    });
}

// --- init molecules page on DOM ready ---
document.addEventListener('DOMContentLoaded', ()=>{
  renderMoleculesList();
});
// ===== REACTIONS PAGE =====
let reactionScene, reactionCamera, reactionRenderer;
let currentReactants = [];
let currentProducts = [];

// Toggle System
document.addEventListener('DOMContentLoaded', () => {
  const toggleBtns = document.querySelectorAll('.toggle-btn');
  const periodicPage = document.querySelector('.container');
  const moleculesPage = document.getElementById('moleculesPage');
  const reactionsPage = document.getElementById('reactionsPage');
  
  toggleBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const targetPage = btn.dataset.page;
      toggleBtns.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      
      if(targetPage === 'periodic') {
        periodicPage.style.display = '';
        moleculesPage.style.display = 'none';
        reactionsPage.style.display = 'none';
      } else if(targetPage === 'molecules') {
        periodicPage.style.display = 'none';
        moleculesPage.style.display = 'block';
        reactionsPage.style.display = 'none';
      } else if(targetPage === 'reactions') {
        periodicPage.style.display = 'none';
        moleculesPage.style.display = 'none';
        reactionsPage.style.display = 'block';
        initReactionViewer();
      }
    });
  });
});

// Init 3D Viewer
function initReactionViewer() {
  const container = document.getElementById('reactionCanvas');
  if (!container || reactionRenderer) return;
  
  reactionScene = new THREE.Scene();
  reactionScene.background = new THREE.Color(0x0d1117);
  
  reactionCamera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
  reactionCamera.position.set(0, 0, 20);
  
  reactionRenderer = new THREE.WebGLRenderer({ antialias: true });
  reactionRenderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(reactionRenderer.domElement);
  
  const ambientLight = new THREE.AmbientLight(0x404040, 0.8);
  reactionScene.add(ambientLight);
  
  const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
  directionalLight.position.set(10, 10, 5);
  reactionScene.add(directionalLight);
  
  animate3D();
}

function animate3D() {
  if (!reactionRenderer) return;
  requestAnimationFrame(animate3D);
  reactionRenderer.render(reactionScene, reactionCamera);
}

// Add Reactant
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('add-item-btn')) {
    openItemSelectionModal();
  }
});

function openItemSelectionModal() {
  const modal = document.getElementById('itemSelectionModal');
  modal.classList.add('active');
  populateItemsGrid();
}

function populateItemsGrid() {
  const grid = document.getElementById('itemsGrid');
  grid.innerHTML = '';
  
  // Elements
  elementsData.forEach(element => {
    const card = document.createElement('div');
    card.className = 'item-card';
    card.innerHTML = `<div class="formula">${element.symbol}</div><div class="name">${element.name}</div>`;
    card.addEventListener('click', () => {
      selectReactant({ id: element.symbol.toLowerCase(), formula: element.symbol, name: element.name });
      closeItemSelectionModal();
    });
    grid.appendChild(card);
  });
  
  // Molecules
  moleculesData.forEach(molecule => {
    const card = document.createElement('div');
    card.className = 'item-card';
    card.innerHTML = `<div class="formula">${molecule.formula}</div><div class="name">${molecule.name}</div>`;
    card.addEventListener('click', () => {
      selectReactant(molecule);
      closeItemSelectionModal();
    });
    grid.appendChild(card);
  });
}

function selectReactant(item) {
  currentReactants.push(item);
  updateReactantsDisplay();
}

function updateReactantsDisplay() {
  const container = document.getElementById('reactantsContainer');
  container.innerHTML = '';
  
  currentReactants.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'equation-item';
    div.innerHTML = `<span>${item.formula}</span><button class="remove-btn" data-index="${index}">×</button>`;
    container.appendChild(div);
    
    if (index < currentReactants.length - 1) {
      const plus = document.createElement('div');
      plus.textContent = '+';
      plus.style.color = 'var(--text-secondary)';
      container.appendChild(plus);
    }
  });
  
  const addBtn = document.createElement('button');
  addBtn.className = 'add-item-btn';
  addBtn.textContent = '+';
  container.appendChild(addBtn);
}

// Remove reactant
document.addEventListener('click', (e) => {
  if (e.target.classList.contains('remove-btn')) {
    const index = parseInt(e.target.dataset.index);
    currentReactants.splice(index, 1);
    updateReactantsDisplay();
  }
});

// Predict Products (Simple Logic)
document.getElementById('predictProducts').addEventListener('click', () => {
  if (currentReactants.length === 0) {
    alert('Add reactants first!');
    return;
  }
  
  // Simple prediction logic
  const formulas = currentReactants.map(r => r.formula).join(' + ');
  
  if (formulas.includes('H₂') && formulas.includes('O₂')) {
    currentProducts = [{ formula: 'H₂O', name: 'Water' }];
  } else if (formulas.includes('Fe') && formulas.includes('CuSO₄')) {
    currentProducts = [{ formula: 'FeSO₄', name: 'Iron sulfate' }, { formula: 'Cu', name: 'Copper' }];
  } else {
    currentProducts = [{ formula: '?', name: 'Unknown product' }];
  }
  
  updateProductsDisplay();
});

function updateProductsDisplay() {
  const container = document.getElementById('productsContainer');
  container.innerHTML = '';
  
  currentProducts.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'equation-item';
    div.innerHTML = `<span>${item.formula}</span>`;
    container.appendChild(div);
    
    if (index < currentProducts.length - 1) {
      const plus = document.createElement('div');
      plus.textContent = '+';
      plus.style.color = 'var(--text-secondary)';
      container.appendChild(plus);
    }
  });
}

// Run Reaction Animation
document.getElementById('runReaction').addEventListener('click', () => {
  if (currentReactants.length === 0 || currentProducts.length === 0) {
    alert('Predict products first!');
    return;
  }
  visualizeReaction();
});

function visualizeReaction() {
  // Clear scene
  while (reactionScene.children.length > 2) {
    reactionScene.remove(reactionScene.children[2]);
  }
  
  // Create reactant molecules (left side)
  const reactantGroup = new THREE.Group();
  currentReactants.forEach((reactant, i) => {
    const geo = new THREE.SphereGeometry(0.8, 16, 16);
    const mat = new THREE.MeshPhongMaterial({ color: 0x4CAF50 });
    const sphere = new THREE.Mesh(geo, mat);
    sphere.position.set(-8, i * 3 - 1.5, 0);
    reactantGroup.add(sphere);
  });
  
  // Create product molecules (right side)
  const productGroup = new THREE.Group();
  currentProducts.forEach((product, i) => {
    const geo = new THREE.SphereGeometry(0.8, 16, 16);
    const mat = new THREE.MeshPhongMaterial({ color: 0x2196F3 });
    const sphere = new THREE.Mesh(geo, mat);
    sphere.position.set(8, i * 3 - 1.5, 0);
    productGroup.add(sphere);
  });
  
  reactionScene.add(reactantGroup);
  reactionScene.add(productGroup);
  
  // Animate collision
  let step = 0;
  function animateCollision() {
    if (step < 100) {
      const progress = step / 100;
      reactantGroup.position.x = -8 + progress * 6;
      productGroup.position.x = 8 - progress * 6;
      step++;
      requestAnimationFrame(animateCollision);
    }
  }
  animateCollision();
}

// Clear
document.getElementById('clearEquation').addEventListener('click', () => {
  currentReactants = [];
  currentProducts = [];
  updateReactantsDisplay();
  document.getElementById('productsContainer').innerHTML = '<span class="auto-text">Auto-generated</span>';
  while (reactionScene.children.length > 2) {
    reactionScene.remove(reactionScene.children[2]);
  }
});

// Modal close
document.getElementById('closeItemModal').addEventListener('click', closeItemSelectionModal);
document.getElementById('itemSelectionModal').addEventListener('click', (e) => {
  if (e.target.id === 'itemSelectionModal') closeItemSelectionModal();
});

function closeItemSelectionModal() {
  document.getElementById('itemSelectionModal').classList.remove('active');
}

// Search
document.getElementById('itemSearch').addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase();
  document.querySelectorAll('.item-card').forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(query) ? '' : 'none';
  });
});
    </script>
</body>
</html>

